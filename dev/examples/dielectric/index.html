<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Eigenvalues of the dielectric matrix · DFTK.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.dftk.org/stable/examples/dielectric/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/periodic_problems/">Problems and plane-wave discretisations</a></li><li><a class="tocitem" href="../../guide/introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../forwarddiff/">Polarizability using automatic differentiation</a></li><li class="is-active"><a class="tocitem" href>Eigenvalues of the dielectric matrix</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../input_output/">Input and output formats</a></li><li><a class="tocitem" href="../wannier90/">Wannierization using Wannier90</a></li></ul></li><li><span class="tocitem">Tipps and tricks</span><ul><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../compare_solvers/">Comparison of DFT solvers</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../../developer/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../developer/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../developer/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../developer/symmetries/">Crystal symmetries</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Response and properties</a></li><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/examples/dielectric.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Eigenvalues-of-the-dielectric-matrix"><a class="docs-heading-anchor" href="#Eigenvalues-of-the-dielectric-matrix">Eigenvalues of the dielectric matrix</a><a id="Eigenvalues-of-the-dielectric-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Eigenvalues-of-the-dielectric-matrix" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=dev/examples/dielectric.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/dev/examples/dielectric.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>We compute a few eigenvalues of the dielectric matrix (q=0,ω=0) iteratively.</p><pre><code class="language-julia hljs">using DFTK
using Plots
using KrylovKit
using Printf

# Calculation parameters
kgrid = [1, 1, 1]
Ecut = 5

# Silicon lattice
a = 10.26
lattice = a / 2 .* [[0 1 1.]; [1 0 1.]; [1 1 0.]]
Si = ElementPsp(:Si, psp=load_psp(&quot;hgh/lda/Si-q4&quot;))
atoms     = [Si, Si]
positions = [ones(3)/8, -ones(3)/8]

# Compute the dielectric operator without symmetries
model = model_LDA(lattice, atoms, positions, symmetries=false)
basis = PlaneWaveBasis(model; Ecut, kgrid)
scfres = self_consistent_field(basis, tol=1e-14)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(ham = Hamiltonian(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), HamiltonianBlock[DFTK.DftHamiltonianBlock(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), Any[DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.30116136598756804 -0.36869760795125184 … -0.5702190219244254 -0.36869760795125195; -0.3686976079512516 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456163; … ; -0.5702190219244256 -0.264614164394795 … -2.291992881132685 -1.1751172086054253; -0.3686976079512515 -0.2539389812456162 … -1.1751172086054256 -0.6560706269776425;;; -0.3686976079512517 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456166; -0.6560706269776425 -1.3741022038947448 … -0.1651225671881503 -0.31565743774427135; … ; -0.2646141643947949 -0.16512256718815066 … -0.8632000905877295 -0.4898593856167607; -0.25393898124561615 -0.31565743774427135 … -0.48985938561676046 -0.31565743774427124;;; -0.5702190219244254 -1.1751172086054258 … -0.1242245197168452 -0.264614164394795; -1.1751172086054256 -2.8292222589777416 … -0.1750685951638031 -0.48985938561676046; … ; -0.1242245197168452 -0.1750685951638037 … -0.30112950922681153 -0.17506859516380358; -0.2646141643947948 -0.48985938561676046 … -0.17506859516380294 -0.1651225671881503;;; … ;;; -0.8720732197039092 -0.36117451106748844 … -3.5504427268225025 -1.881971917366274; -0.3611745110674882 -0.13192205269891222 … -1.3219289313234115 -0.747481991474731; … ; -3.5504427268225025 -1.3219289313234115 … -11.011681230319526 -8.06878895093237; -1.8819719173662737 -0.747481991474731 … -8.06878895093237 -4.5798976647669045;;; -0.5702190219244254 -0.2646141643947948 … -2.2919928811326855 -1.1751172086054256; -0.2646141643947947 -0.16512256718815055 … -0.8632000905877295 -0.48985938561676046; … ; -2.2919928811326855 -0.8632000905877297 … -11.026309596728632 -6.029372075563462; -1.1751172086054253 -0.4898593856167603 … -6.029372075563462 -2.8292222589777416;;; -0.3686976079512518 -0.2539389812456165 … -1.1751172086054256 -0.6560706269776427; -0.25393898124561626 -0.3156574377442714 … -0.4898593856167604 -0.31565743774427135; … ; -1.1751172086054256 -0.48985938561676057 … -6.029372075563461 -2.829222258977741; -0.6560706269776424 -0.3156574377442712 … -2.829222258977741 -1.3741022038947448]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.5274666751506858 0.5044274739112772 … 0.44412715404219233 0.5044274718272727; 0.5044274726472605 0.47725917459198797 … 0.4288920020727799 0.48607514405270624; … ; 0.4441271562757256 0.4288920053774369 … 0.3670950999995954 0.41730357639680765; 0.5044274730492784 0.48607514646381667 … 0.41730357534596374 0.4772591729052063;;; 0.5044274731326065 0.47725917498470577 … 0.4288920024137777 0.486075144515925; 0.4772591737160944 0.44452968897380846 … 0.4098211884331721 0.46474453529828724; … ; 0.4288920046251189 0.40982119171087866 … 0.3603062679412652 0.4089019881902434; 0.4860751457295232 0.4647445377125891 … 0.40890198713482445 0.46474453567300994;;; 0.44412715639963596 0.4173035783277483 … 0.37467442654312166 0.4288920036509791; 0.4173035771149946 0.3873367896362003 … 0.35777195347208346 0.408901987970814; … ; 0.37467442863335226 0.35777195660144934 … 0.3134919557030442 0.35777195470807593; 0.4288920048077866 0.4089019902887856 … 0.3577719537094679 0.4098211899551441;;; … ;;; 0.3720716524611342 0.3538533878365445 … 0.32793549639110736 0.35637416100442665; 0.35385338686013834 0.3317820389398022 … 0.30993601657410536 0.34214930825118783; … ; 0.32793549830017527 0.30993601935011905 … 0.324177329473593 0.327020151269955; 0.3563741620092568 0.3421493101921953 … 0.3270201503257667 0.3434110416316833;;; 0.44412715548638426 0.4288920045128202 … 0.36709509999922013 0.41730357591025924; 0.4288920034204264 0.4098211905205459 … 0.36030626759631096 0.40890198727623694; … ; 0.3670951019951959 0.36030627057513087 … 0.3241773287201606 0.3459587529382591; 0.4173035769983152 0.4089019894081357 … 0.3459587520033368 0.387336788121987;;; 0.5044274725887765 0.48607514601076734 … 0.4173035752009265 0.47725917255038736; 0.4860751448126041 0.46474453688847955 … 0.4089019866512693 0.4647445348751559; … ; 0.41730357734398654 0.40890198984393367 … 0.3459587518662484 0.3873367882615714; 0.4772591737256193 0.4647445371831734 … 0.3873367872689837 0.44452968716273666]), DFTK.RealSpaceMultiplication{Float64, SubArray{Float64, 3, Array{Float64, 4}, Tuple{Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Int64}, true}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.5575517638623483 -0.5479471301962111 … -0.518533223288592 -0.5479471296624231; -0.5479471297984514 -0.5318143671118141 … -0.5184377224145458 -0.5418065870413521; … ; -0.5185332240509941 -0.5184377234519438 … -0.4296212261439472 -0.4895688411293572; -0.5479471300320338 -0.5418065877631493 … -0.489568840711619 -0.5318143668052915;;; -0.5479471300291602 -0.5318143673354587 … -0.5184377225872728 -0.5418065872527176; -0.5318143669039562 -0.5005477192558503 … -0.5121183302795579 -0.5325945669793112; … ; -0.5184377233074693 -0.5121183313001421 … -0.4661344032345994 -0.5043253393574751; -0.5418065876175955 -0.5325945677329152 … -0.5043253389645 -0.5325945672001413;;; -0.518533224035955 -0.4895688416439835 … -0.4981327753054636 -0.5184377229787621; -0.48956884119216915 -0.43645079367579326 … -0.490072219977772 -0.5043253391461993; … ; -0.4981327759726424 -0.49007222097913217 … -0.4651952796735245 -0.4900722204583441; -0.5184377233373109 -0.5043253399211671 … -0.49007222010636464 -0.5121183308279256;;; … ;;; -0.47260172274394 -0.4820441557463695 … -0.3634524749504039 -0.4305619791573823; -0.4820441554652304 -0.47922052959806366 … -0.4126646365163056 -0.4600932860071607; … ; -0.3634524757193719 -0.41266463747506105 … -0.22859973570266218 -0.2848129672567827; -0.4305619794930871 -0.4600932865995864 … -0.28481296672199485 -0.3648044487057327;;; -0.5185332235900046 -0.5184377230235033 … -0.42962122591999724 -0.48956884070925105; -0.5184377227036985 -0.5121183307319793 … -0.4661344028428369 -0.5043253387895568; … ; -0.42962122668352476 -0.46613440385512084 … -0.2285997351574028 -0.34831028415454096; -0.4895688410660297 -0.5043253394364834 … -0.34831028371765577 -0.43645079307078016;;; -0.5479471298144644 -0.5418065875595146 … -0.4895688405639086 -0.5318143665981964; -0.541806587200871 -0.5325945673319462 … -0.504325338653902 -0.5325945668079137; … ; -0.4895688413403524 -0.5043253396944387 … -0.34831028378630147 -0.4364507933081409; -0.5318143669670607 -0.5325945674955355 … -0.4364507928870174 -0.5005477188038576])], DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.33124645469923053 -0.41221726423618577 … -0.6446250911708251 -0.4122172657864024; -0.4122172651024425 -0.7106258194974688 … -0.3541598847365607 -0.30967042423426216; … ; -0.6446250896996941 -0.35415988246930197 … -2.354519007277037 -1.247382473337975; -0.4122172649340069 -0.3096704225449488 … -1.2473824739710808 -0.7106258208777276;;; -0.4122172648478054 -0.7106258193283956 … -0.35415988456828995 -0.3096704239824092; -0.7106258201655044 -1.4301202341767867 … -0.26741970903453605 -0.3835074694252953; … ; -0.3541598830771453 -0.26741970677741406 … -0.9690282258810637 -0.5852827367839923; -0.3096704231336884 -0.3835074677645975 … -0.585282737446436 -0.3835074692714026;;; -0.6446250895607445 -1.2473824719216609 … -0.2476828684791872 -0.354159883722578; -1.2473824726826002 -2.8783362630173346 … -0.3073688616694916 -0.5852827367921457; … ; -0.2476828670561353 -0.3073688595414865 … -0.4528328331972918 -0.30736886091407173; -0.35415988292431905 -0.585282735249142 … -0.30736886156069965 -0.26741970806093174;;; … ;;; -0.972603289986715 -0.4893652789773134 … -3.585959705381799 -1.9561597355192295; -0.48936527967258026 -0.2793605433571737 … -1.4246575512656117 -0.8654259692307039; … ; -3.585959704241699 -1.4246575494483535 … -10.916103636548595 -8.026581766919199; -1.9561597348501039 -0.8654259678821221 … -8.026581767328599 -4.601291071840953;;; -0.6446250900280458 -0.3541598829054779 … -2.3545190070534625 -1.2473824734044174; -0.3541598836780668 -0.267419707399584 … -0.9690282258342555 -0.5852827371300803; … ; -2.3545190058210146 -0.9690282238677197 … -10.930732003165874 -6.031723606779744; -1.2473824726731397 -0.585282735645108 … -6.031723607277781 -2.878336263926535;;; -0.41221726517693963 -0.30967042279436374 … -1.2473824739684076 -0.7106258210254517; -0.3096704236338832 -0.38350746818773807 … -0.585282737619393 -0.3835074696770292; … ; -1.2473824726017915 -0.5852827354672656 … -6.031723607483514 -2.8783362640243104; -0.7106258202190838 -0.38350746805663327 … -2.8783362645957746 -1.4301202355358658]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), nothing, (ψ_reals = Array{ComplexF64, 3}[[0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; … ;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im]],))]), basis = PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), energies = Energies(total = -7.2513387987045395), converged = true, occupation_threshold = 1.0e-6, ρ = [0.12710827549584358 0.1201796562220079 … 0.10056375668457612 0.12017965584425065; 0.12017965594051662 0.10912704986936067 … 0.10050389512326764 0.11588721197567414; … ; 0.10056375716255946 0.10050389577339455 … 0.05464060704121641 0.0834960055690335; 0.12017965610582092 0.11588721247401189 … 0.0834960053382697 0.10912704966620637;;; 0.12017965610378734 0.1091270500175858 … 0.10050389523151393 0.11588721212160351; 0.10912704973159851 0.0897121203125279 … 0.09659641859925364 0.10964497719495783; … ; 0.10050389568285378 0.09659641922182156 … 0.07122114423914629 0.09192171838335865; 0.11588721237351975 0.10964497769603533 … 0.09192171815159479 0.10964497734178962;;; 0.10056375715313082 0.08349600585331944 … 0.08831868259317313 0.10050389547685634; 0.08349600560373156 0.05751667662393912 … 0.08377439362347522 0.09192171825875506; … ; 0.08831868297609072 0.08377439417789384 … 0.07075664170936011 0.08377439388955141; 0.10050389570155524 0.09192171871580576 … 0.08377439369467254 0.09659641893376415;;; … ;;; 0.07447652152324984 0.07940929823384645 … 0.031661597976536816 0.05503081402028301; 0.07940929808375854 0.0779116076868628 … 0.047926999990168875 0.06826914758652987; … ; 0.03166159819569135 0.0479270003529248 … 0.006870415733948304 0.01421539778069693; 0.05503081415986532 0.06826914787185479 … 0.014215397692699475 0.03204851489469611;;; 0.100563756873545 0.10050389550489516 … 0.054640606948551516 0.08349600533696165; 0.10050389530447669 0.09659641887523587 … 0.07122114404494347 0.09192171804841895; … ; 0.05464060726448019 0.07122114454674855 … 0.0068704156795925805 0.02754404278336737; 0.08349600553405057 0.09192171842995511 … 0.02754404267018245 0.05751667636468455;;; 0.12017965595184887 0.11588721233342002 … 0.08349600525667263 0.10912704952894968; 0.11588721208580813 0.10964497742942776 … 0.09192171796841413 0.1096449770809943; … ; 0.0834960056855898 0.09192171858208874 … 0.027544042687966667 0.057516676466396174; 0.10912704977342233 0.10964497753819957 … 0.057516676285940184 0.08971212005033478;;;;], α = 0.8, eigenvalues = [[-0.14431559212258666, 0.29698169241336136, 0.29698169260494095, 0.29698169273960406, 0.3757382672277087, 0.37573826726315634, 0.37573826732865007]], occupation = [[2.0, 2.0, 2.0, 2.0, 0.0, 0.0, 0.0]], εF = 0.3442393821313184, n_iter = 15, n_ep_extra = 3, ψ = Matrix{ComplexF64}[[0.42406434480670896 + 0.8651655922140203im 4.439523006341306e-11 - 6.368277871922772e-11im … 1.0037149901225093e-9 - 1.5468080906427834e-9im -6.124491495509058e-11 + 2.5627820580427633e-10im; 0.03795266214971575 + 0.07743008315231725im 0.061239830407089656 - 0.08256721870332843im … -0.09925349808843713 - 0.06984325779283186im -0.11330435805655548 - 0.08876613331402368im; … ; 0.005640119624178289 + 0.01150683295672066im 0.021982971476724702 - 0.029638933557090276im … -0.010949450818842799 - 0.007704789547407986im -0.06484092478346887 - 0.050798312522376196im; -0.03795266194207111 - 0.07743008290439249im 0.30041052049137734 - 0.40503336988271643im … 0.0014953905623927598 + 0.0010539153683319451im -0.46560375637453094 - 0.36476773772461524im]], diagonalization = NamedTuple{(:λ, :X, :residual_norms, :iterations, :converged, :n_matvec), Tuple{Vector{Vector{Float64}}, Vector{Matrix{ComplexF64}}, Vector{Vector{Float64}}, Vector{Int64}, Bool, Int64}}[(λ = [[-0.14431559212258666, 0.29698169241336136, 0.29698169260494095, 0.29698169273960406, 0.3757382672277087, 0.37573826726315634, 0.37573826732865007]], X = [[0.42406434480670896 + 0.8651655922140203im 4.439523006341306e-11 - 6.368277871922772e-11im … 1.0037149901225093e-9 - 1.5468080906427834e-9im -6.124491495509058e-11 + 2.5627820580427633e-10im; 0.03795266214971575 + 0.07743008315231725im 0.061239830407089656 - 0.08256721870332843im … -0.09925349808843713 - 0.06984325779283186im -0.11330435805655548 - 0.08876613331402368im; … ; 0.005640119624178289 + 0.01150683295672066im 0.021982971476724702 - 0.029638933557090276im … -0.010949450818842799 - 0.007704789547407986im -0.06484092478346887 - 0.050798312522376196im; -0.03795266194207111 - 0.07743008290439249im 0.30041052049137734 - 0.40503336988271643im … 0.0014953905623927598 + 0.0010539153683319451im -0.46560375637453094 - 0.36476773772461524im]], residual_norms = [[1.598339603292718e-9, 2.054206094470093e-9, 1.0086112272185475e-9, 4.927169674447427e-10, 1.266733637742382e-9, 5.492829834188155e-9, 4.773021620018807e-9]], iterations = [3], converged = 1, n_matvec = 24)], stage = :finalize, algorithm = &quot;SCF&quot;, norm_Δρ = 2.6203498798956138e-9)</code></pre><p>Apply ε† = 1 - χ0 (vc + fxc)</p><pre><code class="language-julia hljs">function eps_fun(δρ)
    δV = apply_kernel(basis, δρ; ρ=scfres.ρ)
    χ0δV = apply_χ0(scfres, δV)
    δρ - χ0δV
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">eps_fun (generic function with 1 method)</code></pre><p>eager diagonalizes the subspace matrix at each iteration</p><pre><code class="language-julia hljs">eigsolve(eps_fun, randn(size(scfres.ρ)), 5, :LM; eager=true, verbosity=3);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Arnoldi iteration step 1: normres = 0.042733848612779075
[ Info: Arnoldi iteration step 2: normres = 0.6483836182712697
[ Info: Arnoldi iteration step 3: normres = 0.7464743996950014
[ Info: Arnoldi iteration step 4: normres = 0.49525172551913516
[ Info: Arnoldi iteration step 5: normres = 0.3145436405731765
[ Info: Arnoldi schursolve in iter 1, krylovdim = 5: 0 values converged, normres = (5.26e-02, 7.59e-02, 1.72e-01, 2.43e-01, 4.22e-02)
[ Info: Arnoldi iteration step 6: normres = 0.3902106387440287
[ Info: Arnoldi schursolve in iter 1, krylovdim = 6: 0 values converged, normres = (1.81e-02, 1.62e-01, 3.42e-01, 6.57e-02, 4.35e-02)
[ Info: Arnoldi iteration step 7: normres = 0.08728542854967357
[ Info: Arnoldi schursolve in iter 1, krylovdim = 7: 0 values converged, normres = (8.01e-04, 1.86e-02, 2.07e-02, 2.26e-02, 7.16e-02)
[ Info: Arnoldi iteration step 8: normres = 0.11855680137812523
[ Info: Arnoldi schursolve in iter 1, krylovdim = 8: 0 values converged, normres = (4.14e-05, 1.61e-03, 1.97e-03, 9.59e-03, 6.19e-02)
[ Info: Arnoldi iteration step 9: normres = 0.06418059231128045
[ Info: Arnoldi schursolve in iter 1, krylovdim = 9: 0 values converged, normres = (1.15e-06, 7.37e-05, 1.00e-04, 2.22e-03, 2.66e-02)
[ Info: Arnoldi iteration step 10: normres = 0.088260377076927
[ Info: Arnoldi schursolve in iter 1, krylovdim = 10: 0 values converged, normres = (4.35e-08, 4.55e-06, 6.86e-06, 5.97e-04, 1.35e-02)
[ Info: Arnoldi iteration step 11: normres = 0.07634158072514817
[ Info: Arnoldi schursolve in iter 1, krylovdim = 11: 0 values converged, normres = (1.43e-09, 2.46e-07, 4.13e-07, 1.49e-04, 6.92e-03)
[ Info: Arnoldi iteration step 12: normres = 0.0936661464785826
[ Info: Arnoldi schursolve in iter 1, krylovdim = 12: 0 values converged, normres = (5.75e-11, 1.62e-08, 3.01e-08, 4.31e-05, 4.15e-03)
[ Info: Arnoldi iteration step 13: normres = 0.04175301116409547
[ Info: Arnoldi schursolve in iter 1, krylovdim = 13: 0 values converged, normres = (1.04e-12, 4.83e-10, 9.96e-10, 6.16e-06, 1.46e-03)
[ Info: Arnoldi iteration step 14: normres = 0.7971545776272535
[ Info: Arnoldi schursolve in iter 1, krylovdim = 14: 1 values converged, normres = (5.14e-13, 5.46e-10, 1.41e-09, 7.88e-01, 6.01e-02)
[ Info: Arnoldi iteration step 15: normres = 0.10148301903703663
[ Info: Arnoldi schursolve in iter 1, krylovdim = 15: 1 values converged, normres = (3.61e-14, 5.17e-10, 7.05e-02, 4.04e-05, 2.60e-06)
[ Info: Arnoldi iteration step 16: normres = 0.4611870138622304
[ Info: Arnoldi schursolve in iter 1, krylovdim = 16: 1 values converged, normres = (1.42e-14, 2.04e-09, 1.24e-01, 2.05e-03, 4.41e-01)
[ Info: Arnoldi iteration step 17: normres = 0.029606680817522855
[ Info: Arnoldi schursolve in iter 1, krylovdim = 17: 1 values converged, normres = (2.06e-16, 7.91e-09, 5.65e-03, 7.55e-03, 4.27e-03)
[ Info: Arnoldi iteration step 18: normres = 0.020604347967956266
[ Info: Arnoldi schursolve in iter 1, krylovdim = 18: 1 values converged, normres = (1.75e-18, 1.06e-08, 7.63e-05, 4.60e-05, 1.20e-04)
[ Info: Arnoldi iteration step 19: normres = 0.21562229906378905
[ Info: Arnoldi schursolve in iter 1, krylovdim = 19: 1 values converged, normres = (1.66e-19, 9.31e-06, 7.72e-06, 3.33e-08, 2.28e-05)
[ Info: Arnoldi iteration step 20: normres = 0.03017552090463278
[ Info: Arnoldi schursolve in iter 1, krylovdim = 20: 1 values converged, normres = (2.33e-21, 1.00e-08, 2.96e-07, 9.48e-08, 6.24e-07)
[ Info: Arnoldi iteration step 21: normres = 0.034721761317398736
[ Info: Arnoldi schursolve in iter 1, krylovdim = 21: 1 values converged, normres = (3.36e-23, 1.34e-09, 6.70e-09, 1.06e-08, 1.21e-08)
[ Info: Arnoldi iteration step 22: normres = 0.022785585913493573
[ Info: Arnoldi schursolve in iter 1, krylovdim = 22: 1 values converged, normres = (3.17e-25, 1.95e-11, 1.02e-10, 2.68e-10, 1.44e-11)
[ Info: Arnoldi iteration step 23: normres = 0.4335913510171159
[ Info: Arnoldi schursolve in iter 1, krylovdim = 23: 1 values converged, normres = (5.99e-26, 6.08e-12, 3.18e-11, 9.30e-11, 4.05e-12)
[ Info: Arnoldi iteration step 24: normres = 0.039121348588301845
[ Info: Arnoldi schursolve in iter 1, krylovdim = 24: 1 values converged, normres = (2.11e-27, 1.55e-12, 8.12e-12, 1.21e-02, 3.41e-02)
[ Info: Arnoldi iteration step 25: normres = 0.023746700042590548
[ Info: Arnoldi schursolve in iter 1, krylovdim = 25: 3 values converged, normres = (2.05e-29, 2.39e-14, 1.25e-13, 2.32e-09, 3.61e-09)
[ Info: Arnoldi iteration step 26: normres = 0.10899171784554551
[ Info: Arnoldi schursolve in iter 1, krylovdim = 26: 3 values converged, normres = (9.65e-31, 1.85e-15, 9.65e-15, 1.07e-05, 7.05e-06)
[ Info: Arnoldi iteration step 27: normres = 0.03943458071746189
[ Info: Arnoldi schursolve in iter 1, krylovdim = 27: 3 values converged, normres = (1.63e-32, 5.09e-17, 2.66e-16, 1.96e-07, 2.19e-07)
[ Info: Arnoldi iteration step 28: normres = 0.08510772141951853
[ Info: Arnoldi schursolve in iter 1, krylovdim = 28: 3 values converged, normres = (6.15e-34, 3.23e-18, 1.69e-17, 5.96e-09, 5.06e-09)
[ Info: Arnoldi iteration step 29: normres = 0.012271532351652679
[ Info: Arnoldi schursolve in iter 1, krylovdim = 29: 3 values converged, normres = (3.15e-36, 2.67e-20, 1.39e-19, 1.91e-10, 1.05e-09)
[ Info: Arnoldi iteration step 30: normres = 0.07996641183164155
[ Info: Arnoldi schursolve in iter 1, krylovdim = 30: 3 values converged, normres = (1.04e-37, 1.41e-21, 7.36e-21, 1.23e-11, 5.97e-11)
[ Info: Arnoldi schursolve in iter 2, krylovdim = 19: 3 values converged, normres = (1.04e-37, 1.41e-21, 7.36e-21, 1.23e-11, 5.97e-11)
[ Info: Arnoldi iteration step 20: normres = 0.1515494552296587
[ Info: Arnoldi schursolve in iter 2, krylovdim = 20: 3 values converged, normres = (7.40e-39, 1.74e-22, 9.10e-22, 1.72e-12, 8.33e-12)
[ Info: Arnoldi iteration step 21: normres = 0.08370099359866498
┌ Info: Arnoldi eigsolve finished after 2 iterations:
│ *  6 eigenvalues converged
│ *  norm of residuals = (2.8164029261720396e-40, 1.1358256627958785e-23, 5.999366015897426e-23, 1.2597281807077405e-13, 6.028108472836355e-13, 1.901288280562658e-13)
└ *  number of operations = 32</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forwarddiff/">« Polarizability using automatic differentiation</a><a class="docs-footer-nextpage" href="../atomsbase/">AtomsBase integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 17 September 2022 21:52">Saturday 17 September 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
