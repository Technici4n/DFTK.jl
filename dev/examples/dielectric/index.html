<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Eigenvalues of the dielectric matrix · DFTK.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.dftk.org/stable/examples/dielectric/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/periodic_problems/">Problems and plane-wave discretisations</a></li><li><a class="tocitem" href="../../guide/introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../forwarddiff/">Polarizability using automatic differentiation</a></li><li class="is-active"><a class="tocitem" href>Eigenvalues of the dielectric matrix</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../input_output/">Input and output formats</a></li><li><a class="tocitem" href="../wannier90/">Wannierization using Wannier90</a></li></ul></li><li><span class="tocitem">Tipps and tricks</span><ul><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../compare_solvers/">Comparison of DFT solvers</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../../developer/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../developer/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../developer/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../developer/symmetries/">Crystal symmetries</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Response and properties</a></li><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/examples/dielectric.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Eigenvalues-of-the-dielectric-matrix"><a class="docs-heading-anchor" href="#Eigenvalues-of-the-dielectric-matrix">Eigenvalues of the dielectric matrix</a><a id="Eigenvalues-of-the-dielectric-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Eigenvalues-of-the-dielectric-matrix" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=dev/examples/dielectric.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/dev/examples/dielectric.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>We compute a few eigenvalues of the dielectric matrix (q=0,ω=0) iteratively.</p><pre><code class="language-julia hljs">using DFTK
using Plots
using KrylovKit
using Printf

# Calculation parameters
kgrid = [1, 1, 1]
Ecut = 5

# Silicon lattice
a = 10.26
lattice = a / 2 .* [[0 1 1.]; [1 0 1.]; [1 1 0.]]
Si = ElementPsp(:Si, psp=load_psp(&quot;hgh/lda/Si-q4&quot;))
atoms     = [Si, Si]
positions = [ones(3)/8, -ones(3)/8]

# Compute the dielectric operator without symmetries
model = model_LDA(lattice, atoms, positions, symmetries=false)
basis = PlaneWaveBasis(model; Ecut, kgrid)
scfres = self_consistent_field(basis, tol=1e-14)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(ham = Hamiltonian(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), HamiltonianBlock[DFTK.DftHamiltonianBlock(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), Any[DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.30116136598756804 -0.36869760795125184 … -0.5702190219244254 -0.36869760795125195; -0.3686976079512516 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456163; … ; -0.5702190219244256 -0.264614164394795 … -2.291992881132685 -1.1751172086054253; -0.3686976079512515 -0.2539389812456162 … -1.1751172086054256 -0.6560706269776425;;; -0.3686976079512517 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456166; -0.6560706269776425 -1.3741022038947448 … -0.1651225671881503 -0.31565743774427135; … ; -0.2646141643947949 -0.16512256718815066 … -0.8632000905877295 -0.4898593856167607; -0.25393898124561615 -0.31565743774427135 … -0.48985938561676046 -0.31565743774427124;;; -0.5702190219244254 -1.1751172086054258 … -0.1242245197168452 -0.264614164394795; -1.1751172086054256 -2.8292222589777416 … -0.1750685951638031 -0.48985938561676046; … ; -0.1242245197168452 -0.1750685951638037 … -0.30112950922681153 -0.17506859516380358; -0.2646141643947948 -0.48985938561676046 … -0.17506859516380294 -0.1651225671881503;;; … ;;; -0.8720732197039092 -0.36117451106748844 … -3.5504427268225025 -1.881971917366274; -0.3611745110674882 -0.13192205269891222 … -1.3219289313234115 -0.747481991474731; … ; -3.5504427268225025 -1.3219289313234115 … -11.011681230319526 -8.06878895093237; -1.8819719173662737 -0.747481991474731 … -8.06878895093237 -4.5798976647669045;;; -0.5702190219244254 -0.2646141643947948 … -2.2919928811326855 -1.1751172086054256; -0.2646141643947947 -0.16512256718815055 … -0.8632000905877295 -0.48985938561676046; … ; -2.2919928811326855 -0.8632000905877297 … -11.026309596728632 -6.029372075563462; -1.1751172086054253 -0.4898593856167603 … -6.029372075563462 -2.8292222589777416;;; -0.3686976079512518 -0.2539389812456165 … -1.1751172086054256 -0.6560706269776427; -0.25393898124561626 -0.3156574377442714 … -0.4898593856167604 -0.31565743774427135; … ; -1.1751172086054256 -0.48985938561676057 … -6.029372075563461 -2.829222258977741; -0.6560706269776424 -0.3156574377442712 … -2.829222258977741 -1.3741022038947448]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.5274666755206446 0.5044274792089737 … 0.4441271452679841 0.5044274672436094; 0.5044274737088796 0.47725918014089325 … 0.4288919941125179 0.48607514035604765; … ; 0.4441271558225146 0.42889200893610424 … 0.3670950929991876 0.4173035722333865; 0.5044274726832225 0.4860751508365908 … 0.4173035668338973 0.477259168004939;;; 0.5044274715599509 0.47725917803356094 … 0.4288919919881362 0.48607513820583603; 0.4772591724725189 0.4445296916973384 … 0.409821179078599 0.46474452980859976; … ; 0.4288920018574427 0.4098211932583791 … 0.360306258048511 0.4089019814051228; 0.4860751434102902 0.4647445401582599 … 0.4089019763645219 0.4647445287091889;;; 0.44412715283627857 0.4173035787453194 … 0.37467441538865764 0.42889199603769956; 0.41730357332964557 0.38733678923979964 … 0.35777194313684596 0.4089019807121953; … ; 0.3746744243221169 0.3577719564267309 … 0.3134919443483617 0.3577719464832139; 0.4288920009040316 0.40890199068105154 … 0.3577719420209031 0.4098211818230118;;; … ;;; 0.3720716587070998 0.3538533972238333 … 0.32793549616934026 0.35637416385280246; 0.3538533926864459 0.33178204810746253 … 0.3099360155984923 0.34214931051968034; … ; 0.32793550622137124 0.309936029703075 … 0.3241773319603732 0.3270201563512574; 0.35637416895585483 0.34214931993529946 … 0.3270201513282434 0.34341104545424767;;; 0.4441271598792774 0.4288920128349849 … 0.3670950970645838 0.41730357634303317; 0.42889200792367316 0.4098211991184035 … 0.360306264207071 0.40890198757361435; … ; 0.3670951075384856 0.36030627890758915 … 0.3241773287959227 0.3459587555389411; 0.4173035816913708 0.4089019975203011 … 0.34595875032236867 0.3873367893528783;;; 0.5044274749325256 0.48607515300711346 … 0.4173035691066322 0.4772591702887142; 0.48607514774811666 0.4647445443870652 … 0.4089019807268246 0.46474453308932767; … ; 0.41730357986062655 0.408901995748183 … 0.34595874853709746 0.3873367875240016; 0.4772591757836911 0.46474454342990995 … 0.38733678209742717 0.44452968520129366]), DFTK.RealSpaceMultiplication{Float64, SubArray{Float64, 3, Array{Float64, 4}, Tuple{Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Int64}, true}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.5575517639572687 -0.5479471319260577 … -0.5185332201112397 -0.5479471281196054; -0.547947130482092 -0.5318143693198474 … -0.5184377199754088 -0.541806586169394; … ; -0.5185332232874156 -0.5184377239582977 … -0.42962122246641177 -0.4895688390299596; -0.5479471295347015 -0.541806588807019 … -0.48956883707376864 -0.5318143647692876;;; -0.5479471297954815 -0.5318143686026723 … -0.5184377192742026 -0.5418065854906988; -0.5318143670208799 -0.5005477206460758 … -0.5121183277824917 -0.5325945658139307; … ; -0.5184377219750718 -0.5121183314113046 … -0.4661343989146432 -0.5043253365712578; -0.5418065867867684 -0.5325945684791079 … -0.5043253349529055 -0.5325945647852238;;; -0.5185332232354908 -0.4895688420302396 … -0.4981327721110525 -0.5184377210070895; -0.48956884029909437 -0.43645079372174733 … -0.49007221737149137 -0.5043253374137929; … ; -0.4981327743929086 -0.49007222077370327 … -0.465195275278714 -0.4900722174894799; -0.5184377222214992 -0.5043253401655297 … -0.4900722162014334 -0.5121183283366211;;; … ;;; -0.47260172481924567 -0.48204415851006926 … -0.3634524747688698 -0.43056198032812937; -0.48204415732435835 -0.4792205323597142 … -0.412664636186801 -0.4600932868846094; … ; -0.3634524796266221 -0.4126646414628353 … -0.22859973692638513 -0.28481297059842414; -0.4305619821503679 -0.4600932897008193 … -0.2848129668877544 -0.36480445053970345;;; -0.5185332247087057 -0.5184377252571868 … -0.42962122448082973 -0.48956884065514594; -0.5184377240139927 -0.5121183333566914 … -0.46613440148880403 -0.5043253387969893; … ; -0.42962122863253405 -0.46613440628853914 … -0.22859973458321922 -0.3483102853374622; -0.4895688423263043 -0.5043253415292852 … -0.34831028242900497 -0.4364507933109088;;; -0.5479471302777652 -0.5418065895129849 … -0.48956883801252576 -0.5318143655807358; -0.5418065881846663 -0.5325945698730724 … -0.5043253365422233 -0.5325945662390674; … ; -0.4895688416527917 -0.5043253409335624 … -0.348310281285618 -0.43645079249785623; -0.5318143671265574 -0.5325945689093119 … -0.43645079019017974 -0.5005477176508527])], DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.3312464544241921 -0.41221726066833586 … -0.644625096767681 -0.41221726882724796; -0.41221726472446396 -0.7106258161565968 … -0.3541598902576857 -0.3096704270589627; … ; -0.6446250893893266 -0.35415987941698845 … -2.354519010599909 -1.2473824754019986; -0.41221726480273047 -0.30967041921604443 … -1.2473824788452967 -0.7106258237419911;;; -0.41221726618678234 -0.7106258175467541 … -0.35415989168086115 -0.3096704285304794; -0.7106258215260035 -1.430120232843482 … -0.26741971589204294 -0.3835074737496023; … ; -0.354159884512424 -0.2674197053410761 … -0.9690282314538616 -0.5852827407828957; -0.3096704246220944 -0.3835074660651194 … -0.585282744205144 -0.38350747382030614;;; -0.6446250923236376 -1.247382471890346 … -0.24768287643924009 -0.35415988936418497; -1.2473824755748744 -2.878336263459689 … -0.30736886939844854 -0.5852827423183581; … ; -0.24768286978763687 -0.3073688595107761 … -0.45283284015716385 -0.30736886617006953; -0.35415988571226237 -0.5852827351012386 … -0.30736886934433316 -0.26741971370175954;;; … ;;; -0.972603285816055 -0.4893652723537244 … -3.585959705422032 -1.9561597338416008; -0.48936527570540067 -0.27936053695116386 … -1.4246575519117202 -0.8654259678396601; … ; -3.5859597002277535 -1.4246575430831716 … -10.91610363528554 -8.026581765179538; -1.9561597305607867 -0.8654259612402508 … -8.026581766491882 -4.60129106985236;;; -0.6446250867538537 -0.3541598768169967 … -2.354519008548931 -1.2473824729175385; -0.3541598804851142 -0.2674197014264385 … -0.9690282278694625 -0.5852827368401354; … ; -2.354519002226734 -0.9690282179686798 … -10.93073200251593 -6.031723605361982; -1.2473824692403588 -0.5852827296257443 … -6.031723607670098 -2.8783362629357723;;; -0.4122172632964914 -0.3096704177514879 … -1.2473824775113191 -0.7106258222696644; -0.3096704216821659 -0.3835074632302786 … -0.5852827414321591 -0.3835074708940111; … ; -1.2473824703975906 -0.58528273080214 … -6.031723608311981 -2.8783362639515957; -0.7106258183205088 -0.38350746322367313 … -2.8783362670704937 -1.4301202363443037]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), nothing, (ψ_reals = Array{ComplexF64, 3}[[0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; … ;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im]],))]), basis = PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), energies = Energies(total = -7.2513387987045395), converged = true, occupation_threshold = 1.0e-6, ρ = [0.12710827556562582 0.12017965744620548 … 0.10056375469255474 0.12017965475241175; 0.12017965642432334 0.1091270513327812 … 0.10050389359468496 0.11588721137366362; … ; 0.10056375668383859 0.10050389609072143 … 0.05464060551954378 0.08349600440930029; 0.12017965575386315 0.11588721319471246 … 0.08349600332867621 0.1091270483168018;;; 0.120179655938415 0.10912705085745837 … 0.10050389315524608 0.11588721090508401; 0.1091270498090921 0.0897121211189736 … 0.09659641707601477 0.10964497642008694; … ; 0.10050389484785367 0.09659641928963199 … 0.07122114209767598 0.09192171674013865; 0.11588721179990645 0.10964497819218487 … 0.09192171578568742 0.10964497573609144;;; 0.1005637566512847 0.08349600606669201 … 0.08831868075978726 0.10050389424122892; 0.08349600511038599 0.057516676643630915 … 0.08377439218046738 0.09192171723703832; … ; 0.08831868206942543 0.08377439406415492 … 0.07075663954047419 0.08377439224579356; 0.10050389500228724 0.09192171885992281 … 0.08377439153264658 0.09659641741403999;;; … ;;; 0.07447652258381643 0.07940929970926551 … 0.03166159792479992 0.055030814507066504; 0.07940929907626604 0.0779116091421949 … 0.0479269998654971 0.06826914800912791; … ; 0.031661599309250846 0.04792700186174418 … 0.006870415855938602 0.014215398330552244; 0.055030815264732906 0.06826914936547482 … 0.014215397719974624 0.03204851542173696;;; 0.10056375757490765 0.10050389690472222 … 0.05464060635305979 0.08349600530707328; 0.10050389612562498 0.09659642047634012 … 0.07122114337372804 0.09192171805280241; … ; 0.05464060807093178 0.07122114575303232 … 0.0068704156223534625 0.027544043089829644; 0.08349600623024184 0.09192171966422127 … 0.027544042336328574 0.057516676467582246;;; 0.12017965627972295 0.11588721368211995 … 0.08349600384725724 0.10912704885460629; 0.11588721276503247 0.10964497911904313 … 0.09192171672301508 0.1096449767027638; … ; 0.08349600585818516 0.09192171931288345 … 0.027544042040108525 0.05751667611918046; 0.1091270498791321 0.10964497847823097 … 0.057516675130316365 0.08971211938149663;;;;], α = 0.8, eigenvalues = [[-0.1443155922881381, 0.2969816918726847, 0.2969816923677725, 0.29698169288004994, 0.37573826696020585, 0.37573826705584357, 0.37573826733393995]], occupation = [[2.0, 2.0, 2.0, 2.0, 0.0, 0.0, 0.0]], εF = 0.3442393821326383, n_iter = 15, n_ep_extra = 3, ψ = Matrix{ComplexF64}[[0.9496001211529413 - 0.16310021537734232im -1.698641099246277e-10 - 7.334422006578291e-10im … 2.95767016055422e-9 + 2.6893369323299315e-9im 4.0710204014182926e-9 + 4.911937726939841e-9im; 0.08498675554699942 - 0.014597047386482973im 0.019843644029045728 + 0.07193480107891544im … 0.36177710361417936 - 0.40227206645516im -0.1372370753235513 + 0.11386965891508102im; … ; 0.012629824896832415 - 0.0021692564686334246im -0.0037120473365681982 - 0.013456459755770589im … 0.04685297233623563 - 0.052097487846066194im -0.003349827679718542 + 0.002779431642906104im; -0.08498675528486478 + 0.014597047799602457im -0.020542732328435717 - 0.07446901114452963im … 0.056532256649675934 - 0.06286100718282049im 0.10732937505609932 - 0.0890545456344796im]], diagonalization = NamedTuple{(:λ, :X, :residual_norms, :iterations, :converged, :n_matvec), Tuple{Vector{Vector{Float64}}, Vector{Matrix{ComplexF64}}, Vector{Vector{Float64}}, Vector{Int64}, Bool, Int64}}[(λ = [[-0.1443155922881381, 0.2969816918726847, 0.2969816923677725, 0.29698169288004994, 0.37573826696020585, 0.37573826705584357, 0.37573826733393995]], X = [[0.9496001211529413 - 0.16310021537734232im -1.698641099246277e-10 - 7.334422006578291e-10im … 2.95767016055422e-9 + 2.6893369323299315e-9im 4.0710204014182926e-9 + 4.911937726939841e-9im; 0.08498675554699942 - 0.014597047386482973im 0.019843644029045728 + 0.07193480107891544im … 0.36177710361417936 - 0.40227206645516im -0.1372370753235513 + 0.11386965891508102im; … ; 0.012629824896832415 - 0.0021692564686334246im -0.0037120473365681982 - 0.013456459755770589im … 0.04685297233623563 - 0.052097487846066194im -0.003349827679718542 + 0.002779431642906104im; -0.08498675528486478 + 0.014597047799602457im -0.020542732328435717 - 0.07446901114452963im … 0.056532256649675934 - 0.06286100718282049im 0.10732937505609932 - 0.0890545456344796im]], residual_norms = [[3.401907124366346e-9, 4.0731090014836075e-9, 3.4429750121153315e-9, 2.094228597926029e-9, 1.2687675190412994e-9, 1.4457912433038375e-9, 4.1180982302952575e-10]], iterations = [3], converged = 1, n_matvec = 24)], stage = :finalize, algorithm = &quot;SCF&quot;, norm_Δρ = 1.398287944014542e-8)</code></pre><p>Apply ε† = 1 - χ0 (vc + fxc)</p><pre><code class="language-julia hljs">function eps_fun(δρ)
    δV = apply_kernel(basis, δρ; ρ=scfres.ρ)
    χ0δV = apply_χ0(scfres, δV)
    δρ - χ0δV
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">eps_fun (generic function with 1 method)</code></pre><p>eager diagonalizes the subspace matrix at each iteration</p><pre><code class="language-julia hljs">eigsolve(eps_fun, randn(size(scfres.ρ)), 5, :LM; eager=true, verbosity=3);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Arnoldi iteration step 1: normres = 0.039176259222447295
[ Info: Arnoldi iteration step 2: normres = 0.5409655878743758
[ Info: Arnoldi iteration step 3: normres = 0.9529277366868515
[ Info: Arnoldi iteration step 4: normres = 0.3162688545118157
[ Info: Arnoldi iteration step 5: normres = 0.49963513125241676
[ Info: Arnoldi schursolve in iter 1, krylovdim = 5: 0 values converged, normres = (5.68e-02, 7.72e-02, 4.45e-01, 2.06e-01, 1.69e-02)
[ Info: Arnoldi iteration step 6: normres = 0.32141139383979045
[ Info: Arnoldi schursolve in iter 1, krylovdim = 6: 0 values converged, normres = (1.57e-02, 1.68e-01, 2.31e-01, 1.22e-01, 5.25e-02)
[ Info: Arnoldi iteration step 7: normres = 0.08051241768752461
[ Info: Arnoldi schursolve in iter 1, krylovdim = 7: 0 values converged, normres = (6.31e-04, 1.55e-02, 1.21e-02, 4.53e-02, 5.50e-02)
[ Info: Arnoldi iteration step 8: normres = 0.10606989898531853
[ Info: Arnoldi schursolve in iter 1, krylovdim = 8: 0 values converged, normres = (2.88e-05, 1.16e-03, 1.01e-03, 1.50e-02, 4.73e-02)
[ Info: Arnoldi iteration step 9: normres = 0.07871649973644768
[ Info: Arnoldi schursolve in iter 1, krylovdim = 9: 0 values converged, normres = (9.87e-07, 6.56e-05, 6.35e-05, 4.25e-03, 4.30e-02)
[ Info: Arnoldi iteration step 10: normres = 0.1064646305837253
[ Info: Arnoldi schursolve in iter 1, krylovdim = 10: 0 values converged, normres = (4.58e-08, 5.04e-06, 5.43e-06, 1.66e-03, 4.08e-02)
[ Info: Arnoldi iteration step 11: normres = 0.08167504122769666
[ Info: Arnoldi schursolve in iter 1, krylovdim = 11: 0 values converged, normres = (1.63e-09, 2.98e-07, 3.58e-07, 4.99e-04, 2.96e-02)
[ Info: Arnoldi iteration step 12: normres = 0.08294772647749332
[ Info: Arnoldi schursolve in iter 1, krylovdim = 12: 0 values converged, normres = (5.85e-11, 1.76e-08, 2.34e-08, 1.38e-04, 1.81e-02)
[ Info: Arnoldi iteration step 13: normres = 0.07549972517966175
[ Info: Arnoldi schursolve in iter 1, krylovdim = 13: 0 values converged, normres = (1.88e-12, 9.25e-10, 1.37e-09, 3.21e-05, 8.87e-03)
[ Info: Arnoldi iteration step 14: normres = 0.5178850292206473
[ Info: Arnoldi schursolve in iter 1, krylovdim = 14: 1 values converged, normres = (8.67e-13, 2.19e-09, 8.98e-09, 5.17e-01, 7.24e-03)
[ Info: Arnoldi iteration step 15: normres = 0.10327207425573846
[ Info: Arnoldi schursolve in iter 1, krylovdim = 15: 1 values converged, normres = (4.53e-14, 3.22e-09, 3.81e-02, 1.59e-04, 8.70e-06)
[ Info: Arnoldi iteration step 16: normres = 0.41523776633291193
[ Info: Arnoldi schursolve in iter 1, krylovdim = 16: 1 values converged, normres = (1.58e-14, 1.21e-08, 5.68e-02, 4.59e-04, 4.08e-01)
[ Info: Arnoldi iteration step 17: normres = 0.02938060588110397
[ Info: Arnoldi schursolve in iter 1, krylovdim = 17: 1 values converged, normres = (2.22e-16, 1.24e-07, 2.30e-03, 2.31e-03, 8.86e-03)
[ Info: Arnoldi iteration step 18: normres = 0.022702794724268262
[ Info: Arnoldi schursolve in iter 1, krylovdim = 18: 1 values converged, normres = (2.07e-18, 4.86e-08, 3.43e-05, 1.46e-04, 3.49e-05)
[ Info: Arnoldi iteration step 19: normres = 0.12759637049194775
[ Info: Arnoldi schursolve in iter 1, krylovdim = 19: 1 values converged, normres = (1.11e-19, 2.17e-06, 2.04e-06, 9.33e-09, 1.45e-05)
[ Info: Arnoldi iteration step 20: normres = 0.1132266910815863
[ Info: Arnoldi schursolve in iter 1, krylovdim = 20: 1 values converged, normres = (6.14e-21, 5.13e-08, 2.91e-07, 1.63e-06, 4.37e-08)
[ Info: Arnoldi iteration step 21: normres = 0.02159438411188774
[ Info: Arnoldi schursolve in iter 1, krylovdim = 21: 1 values converged, normres = (5.55e-23, 3.47e-09, 2.56e-09, 2.34e-08, 1.22e-08)
[ Info: Arnoldi iteration step 22: normres = 0.04159440263698619
[ Info: Arnoldi schursolve in iter 1, krylovdim = 22: 1 values converged, normres = (9.46e-25, 1.05e-10, 5.26e-11, 2.03e-10, 7.60e-10)
[ Info: Arnoldi iteration step 23: normres = 0.4554671632068655
[ Info: Arnoldi schursolve in iter 1, krylovdim = 23: 1 values converged, normres = (3.57e-25, 1.58e-10, 8.13e-11, 6.47e-10, 2.14e-09)
[ Info: Arnoldi iteration step 24: normres = 0.012740890937967939
[ Info: Arnoldi schursolve in iter 1, krylovdim = 24: 1 values converged, normres = (2.15e-27, 2.83e-12, 1.43e-12, 4.62e-09, 2.01e-08)
[ Info: Arnoldi iteration step 25: normres = 0.06480176371442331
[ Info: Arnoldi schursolve in iter 1, krylovdim = 25: 3 values converged, normres = (5.75e-29, 1.21e-13, 6.11e-14, 1.86e-04, 8.72e-05)
[ Info: Arnoldi iteration step 26: normres = 0.052286091412604485
[ Info: Arnoldi schursolve in iter 1, krylovdim = 26: 3 values converged, normres = (1.36e-30, 4.83e-15, 2.44e-15, 3.87e-09, 2.73e-08)
[ Info: Arnoldi iteration step 27: normres = 0.03725493199019442
[ Info: Arnoldi schursolve in iter 1, krylovdim = 27: 3 values converged, normres = (2.08e-32, 1.18e-16, 5.98e-17, 3.15e-09, 1.68e-08)
[ Info: Arnoldi iteration step 28: normres = 0.08093084278327231
[ Info: Arnoldi schursolve in iter 1, krylovdim = 28: 3 values converged, normres = (7.37e-34, 6.95e-18, 3.51e-18, 2.19e-09, 9.18e-09)
[ Info: Arnoldi iteration step 29: normres = 0.01791854843930953
[ Info: Arnoldi schursolve in iter 1, krylovdim = 29: 3 values converged, normres = (5.51e-36, 8.37e-20, 4.23e-20, 1.49e-10, 1.24e-10)
[ Info: Arnoldi iteration step 30: normres = 0.22206643639332693
[ Info: Arnoldi schursolve in iter 1, krylovdim = 30: 3 values converged, normres = (5.46e-37, 1.39e-20, 7.03e-21, 2.76e-11, 2.33e-11)
[ Info: Arnoldi schursolve in iter 2, krylovdim = 19: 3 values converged, normres = (5.46e-37, 1.39e-20, 7.03e-21, 2.76e-11, 2.33e-11)
[ Info: Arnoldi iteration step 20: normres = 0.06256097581211502
[ Info: Arnoldi schursolve in iter 2, krylovdim = 20: 3 values converged, normres = (1.59e-38, 6.98e-22, 3.52e-22, 1.56e-12, 1.32e-12)
[ Info: Arnoldi iteration step 21: normres = 0.06592505911389378
┌ Info: Arnoldi eigsolve finished after 2 iterations:
│ *  6 eigenvalues converged
│ *  norm of residuals = (4.477233407425488e-40, 3.260261644923299e-23, 3.626987651637051e-23, 8.090888413511976e-14, 6.237660190666269e-14, 5.231736041939962e-14)
└ *  number of operations = 32</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forwarddiff/">« Polarizability using automatic differentiation</a><a class="docs-footer-nextpage" href="../atomsbase/">AtomsBase integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 17 September 2022 13:11">Saturday 17 September 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
