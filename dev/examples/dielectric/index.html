<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Eigenvalues of the dielectric matrix · DFTK.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.dftk.org/stable/examples/dielectric/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/periodic_problems/">Problems and plane-wave discretisations</a></li><li><a class="tocitem" href="../../guide/introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../forwarddiff/">Polarizability using automatic differentiation</a></li><li class="is-active"><a class="tocitem" href>Eigenvalues of the dielectric matrix</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../input_output/">Input and output formats</a></li><li><a class="tocitem" href="../wannier90/">Wannierization using Wannier90</a></li></ul></li><li><span class="tocitem">Tipps and tricks</span><ul><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../compare_solvers/">Comparison of DFT solvers</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../../developer/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../developer/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../developer/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../developer/symmetries/">Crystal symmetries</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Response and properties</a></li><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Eigenvalues of the dielectric matrix</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/examples/dielectric.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Eigenvalues-of-the-dielectric-matrix"><a class="docs-heading-anchor" href="#Eigenvalues-of-the-dielectric-matrix">Eigenvalues of the dielectric matrix</a><a id="Eigenvalues-of-the-dielectric-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Eigenvalues-of-the-dielectric-matrix" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=dev/examples/dielectric.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/dev/examples/dielectric.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>We compute a few eigenvalues of the dielectric matrix (q=0,ω=0) iteratively.</p><pre><code class="language-julia hljs">using DFTK
using Plots
using KrylovKit
using Printf

# Calculation parameters
kgrid = [1, 1, 1]
Ecut = 5

# Silicon lattice
a = 10.26
lattice = a / 2 .* [[0 1 1.]; [1 0 1.]; [1 1 0.]]
Si = ElementPsp(:Si, psp=load_psp(&quot;hgh/lda/Si-q4&quot;))
atoms     = [Si, Si]
positions = [ones(3)/8, -ones(3)/8]

# Compute the dielectric operator without symmetries
model = model_LDA(lattice, atoms, positions, symmetries=false)
basis = PlaneWaveBasis(model; Ecut, kgrid)
scfres = self_consistent_field(basis, tol=1e-14)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(ham = Hamiltonian(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), HamiltonianBlock[DFTK.DftHamiltonianBlock(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), Any[DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.30116136598756804 -0.36869760795125184 … -0.5702190219244254 -0.36869760795125195; -0.3686976079512516 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456163; … ; -0.5702190219244256 -0.264614164394795 … -2.291992881132685 -1.1751172086054253; -0.3686976079512515 -0.2539389812456162 … -1.1751172086054256 -0.6560706269776425;;; -0.3686976079512517 -0.6560706269776427 … -0.2646141643947948 -0.2539389812456166; -0.6560706269776425 -1.3741022038947448 … -0.1651225671881503 -0.31565743774427135; … ; -0.2646141643947949 -0.16512256718815066 … -0.8632000905877295 -0.4898593856167607; -0.25393898124561615 -0.31565743774427135 … -0.48985938561676046 -0.31565743774427124;;; -0.5702190219244254 -1.1751172086054258 … -0.1242245197168452 -0.264614164394795; -1.1751172086054256 -2.8292222589777416 … -0.1750685951638031 -0.48985938561676046; … ; -0.1242245197168452 -0.1750685951638037 … -0.30112950922681153 -0.17506859516380358; -0.2646141643947948 -0.48985938561676046 … -0.17506859516380294 -0.1651225671881503;;; … ;;; -0.8720732197039092 -0.36117451106748844 … -3.5504427268225025 -1.881971917366274; -0.3611745110674882 -0.13192205269891222 … -1.3219289313234115 -0.747481991474731; … ; -3.5504427268225025 -1.3219289313234115 … -11.011681230319526 -8.06878895093237; -1.8819719173662737 -0.747481991474731 … -8.06878895093237 -4.5798976647669045;;; -0.5702190219244254 -0.2646141643947948 … -2.2919928811326855 -1.1751172086054256; -0.2646141643947947 -0.16512256718815055 … -0.8632000905877295 -0.48985938561676046; … ; -2.2919928811326855 -0.8632000905877297 … -11.026309596728632 -6.029372075563462; -1.1751172086054253 -0.4898593856167603 … -6.029372075563462 -2.8292222589777416;;; -0.3686976079512518 -0.2539389812456165 … -1.1751172086054256 -0.6560706269776427; -0.25393898124561626 -0.3156574377442714 … -0.4898593856167604 -0.31565743774427135; … ; -1.1751172086054256 -0.48985938561676057 … -6.029372075563461 -2.829222258977741; -0.6560706269776424 -0.3156574377442712 … -2.829222258977741 -1.3741022038947448]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.NoopOperator{Float64}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137)), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.5274666749305872 0.5044274722152247 … 0.44412715635056094 0.5044274731191779; 0.5044274715799582 0.4772591725406415 … 0.4288920039591961 0.48607514447814687; … ; 0.4441271575181226 0.4288920056032316 … 0.3670951010838543 0.4173035779251226; 0.5044274737125408 0.4860751456490776 … 0.4173035773124503 0.47725917459673917;;; 0.5044274666620483 0.47725916742453917 … 0.4288919995166239 0.4860751398008825; 0.47725916687516146 0.44452968182812563 … 0.4098211848084568 0.46474452978089315; … ; 0.42889200070132666 0.40982118640516824 … 0.3603062656378426 0.40890198536314765; 0.4860751403764708 0.46474453086806533 … 0.40890198469953953 0.46474453196501225;;; 0.4441271443272292 0.41730356568576826 … 0.37467441857183775 0.4288919933146195; 0.41730356539942853 0.38733677832978775 … 0.35777194473504903 0.4089019771923008; … ; 0.37467441957413516 0.35777194598543083 … 0.3134919498458235 0.357771947393066; 0.4288919937676417 0.4089019779367919 … 0.3577719468005272 0.40982118093367076;;; … ;;; 0.3720716677648005 0.3538534019294621 … 0.3279355101096612 0.35637417606532895; 0.35385340171408425 0.331782051914523 … 0.3099360317777813 0.3421493238738507; … ; 0.3279355094172716 0.3099360314463243 … 0.32417733607947874 0.3270201602880558; 0.35637417595488874 0.34214932401368703 … 0.32702016093583924 0.3434110542739332;;; 0.444127166741595 0.42889201424206985 … 0.36709511092569747 0.4173035875562741; 0.42889201379041136 0.4098211990867427 … 0.36030627926930764 0.40890199879040445; … ; 0.3670951112050568 0.3603062800192068 … 0.3241773346124775 0.3459587607547125; 0.41730358783590943 0.4089019995101472 … 0.3459587607917701 0.3873367983797396;;; 0.5044274785141784 0.48607515030666476 … 0.41730358225119113 0.4772591794973994; 0.48607514971534727 0.4647445402875872 … 0.40890199380101944 0.46474454119379593; … ; 0.41730358314306176 0.40890199518670156 … 0.3459587557930384 0.3873367934749063; 0.47725918000176154 0.4647445422423792 … 0.3873367930840999 0.44452969367570067]), DFTK.RealSpaceMultiplication{Float64, SubArray{Float64, 3, Array{Float64, 4}, Tuple{Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}, Int64}, true}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.5575517638531994 -0.5479471298887026 … -0.5185332237286736 -0.5479471299814817; -0.5479471297034768 -0.5318143669545181 … -0.5184377229546876 -0.5418065872540236; … ; -0.5185332241043679 -0.5184377233993656 … -0.42962122523341495 -0.4895688409313361; -0.5479471301263387 -0.5418065875442756 … -0.4895688406486841 -0.5318143670061606;;; -0.5479471284536392 -0.5318143655899887 … -0.5184377218317591 -0.5418065860860175; -0.5318143653525347 -0.50054771785277 … -0.5121183294291975 -0.5325945656673519; … ; -0.5184377221341244 -0.5121183298602434 … -0.4661344018459178 -0.5043253382479584; -0.5418065862259469 -0.5325945660078588 … -0.5043253380416206 -0.5325945661507859;;; -0.5185332208615826 -0.4895688383475479 … -0.49813277322660876 -0.5184377202624657; -0.48956883809096385 -0.43645079075214926 … -0.4900722176485235 -0.5043253362621821; … ; -0.4981327735047927 -0.49007221811083335 … -0.46519527767869306 -0.49007221834432363; -0.5184377204152609 -0.5043253366480217 … -0.4900722181844411 -0.5121183284306265;;; … ;;; -0.4726017274630681 -0.4820441598958708 … -0.3634524801628855 -0.4305619841355908; -0.48204415976083986 -0.47922053319954305 … -0.412664641556021 -0.46009329076288324; … ; -0.36345248034945893 -0.4126646419905859 … -0.22859973877272707 -0.2848129716207318; -0.4305619842907181 -0.460093291061124 … -0.28481297183775944 -0.3648044535808636;;; -0.5185332266062443 -0.5184377256088271 … -0.4296212287459261 -0.48956884380509913; -0.51843772546898 -0.5121183330240532 … -0.4661344059621698 -0.5043253418770156; … ; -0.4296212293081285 -0.46613440657509453 … -0.22859973621135832 -0.3483102862437276; -0.48956884401670075 -0.5043253422031039 … -0.34831028582023704 -0.43645079575918494;;; -0.5479471313307044 -0.5418065886941843 … -0.4895688420799212 -0.5318143682956672; -0.5418065885462275 -0.5325945683959474 … -0.5043253404606707 -0.5325945684768033; … ; -0.489568842571604 -0.5043253409891245 … -0.3483102833123455 -0.43645079399950204; -0.5318143684723823 -0.5325945687660527 … -0.43645079361396966 -0.5005477201536235])], DFTK.FourierMultiplication{Float64, Vector{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [0.0, 0.5625437115174675, 2.25017484606987, 2.25017484606987, 0.5625437115174675, 0.5625437115174675, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276  …  3.7502914101164504, 3.7502914101164504, 2.0626602755640477, 1.5001165640465801, 0.7500582820232901, 2.0626602755640477, 4.50034969213974, 3.5627768396106276, 1.5001165640465801, 0.5625437115174675]), DFTK.RealSpaceMultiplication{Float64, Array{Float64, 3}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), [-0.33124645491018023 -0.4122172656247298 … -0.644625089302538 -0.4122172648135557; -0.41221726607477027 -0.7106258213915193 … -0.3541598833902863 -0.3096704240214931; … ; -0.6446250885106709 -0.354159882190929 … -2.3545190052822456 -1.2473824716116388; -0.41221726436504935 -0.30967042314081417 … -1.2473824719416595 -0.7106258193870639;;; -0.4122172697428427 -0.7106258251430924 … -0.35415988670993 -0.3096704275307516; -0.7106258254550157 -1.430120239919389 … -0.267419711808891 -0.38350747363073007; … ; -0.35415988582759267 -0.26741971064322584 … -0.9690282267958047 -0.5852827385015715; -0.30967042709509224 -0.38350747288406484 … -0.5852827389588415 -0.3835074719300449;;; -0.6446250984587788 -1.2473824812672054 … -0.24768287437161618 -0.3541598913426412; -1.247382481296961 -2.8783362714001033 … -0.3073688680772776 -0.5852827446866418; … ; -0.24768287364750274 -0.3073688672892062 … -0.4528328370596811 -0.3073688661150612; -0.354159891042414 -0.5852827443279902 … -0.3073688665477168 -0.26741971468510606;;; … ;;; -0.9726032794021768 -0.48936526903389715 … -3.585959696875727 -1.9561597254365357; -0.48936526911424383 -0.2793605339839323 … -1.4246575411016513 -0.8654259583637636; … ; -3.58595969775469 -1.4246575418676732 … -10.916103633012774 -8.026581762265046; -1.9561597257021033 -0.865425958522168 … -8.026581761834292 -4.601291064073835;;; -0.6446250817890747 -0.354159875761552 … -2.3545189989529143 -1.2473824648542506; -0.35415987607336336 -0.26741970112546104 … -0.9690282172805916 -0.5852827287033716; … ; -2.3545189992357574 -0.9690282171436175 … -10.930731998327513 -6.0317236010524775; -1.2473824647862166 -0.585282728309717 … -6.031723600591929 -2.878336256357187;;; -0.4122172607677778 -0.309670419633136 … -1.2473824684341557 -0.7106258157759106; -0.30967042007649653 -0.3835074658526316 … -0.5852827322764116 -0.3835074650272787; … ; -1.2473824680339678 -0.5852827314191835 … -6.031723603082768 -2.878336259502337; -0.7106258154482632 -0.3835074642679447 … -2.878336259507611 -1.4301202303726677]), DFTK.NonlocalOperator{Float64, Matrix{ComplexF64}, Matrix{Float64}}(PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), KPoint([     0,      0,      0], spin = 1, num. G vectors =   137), ComplexF64[0.11164094023604486 + 0.0im 0.1729534009156557 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.07139183057793365 - 0.07139183057793365im 0.10318729458139622 - 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im 0.035578676822652595 - 0.035578676822652595im; … ; -0.08538801146445177 + 0.0im -0.10864081623630145 + 0.0im … 0.0 + 0.08076812854291712im 0.0 - 0.0im; -0.07139183057793365 + 0.07139183057793365im -0.10318729458139622 + 0.10318729458139622im … -0.035578676822652595 + 0.035578676822652595im -0.035578676822652595 + 0.035578676822652595im], [5.90692831 -1.26189397 … 0.0 0.0; -1.26189397 3.25819622 … 0.0 0.0; … ; 0.0 0.0 … 2.72701346 0.0; 0.0 0.0 … 0.0 2.72701346]), nothing, (ψ_reals = Array{ComplexF64, 3}[[0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; … ;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im;;; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; … ; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im … 0.0 + 0.0im 0.0 + 0.0im]],))]), basis = PlaneWaveBasis(model = Model(lda_x+lda_c_pw, spin_polarization = :none), Ecut = 5.0 Ha, kgrid = [1, 1, 1]), energies = Energies(total = -7.251338798704542), converged = true, occupation_threshold = 1.0e-6, ρ = [0.12710827548911763 0.12017965600438674 … 0.10056375696048264 0.12017965607004566; 0.12017965587330402 0.1091270497651094 … 0.1005038954617691 0.11588721212250525; … ; 0.10056375719602179 0.10050389574044426 … 0.054640606664460856 0.08349600545964417; 0.12017965617255977 0.11588721232289878 … 0.08349600530350372 0.10912704979933652;;; 0.12017965498880463 0.10912704886073883 … 0.100503894758041 0.11588721131609944; 0.10912704870336118 0.08971211949862527 … 0.0965964180805241 0.10964497632262549; … ; 0.10050389494753037 0.09659641834346705 … 0.07122114355075498 0.09192171772900191; 0.11588721141270839 0.1096449765490313 … 0.09192171760731062 0.10964497664406468;;; 0.1005637551629776 0.08349600403232758 … 0.08831868140004455 0.10050389377458063; 0.08349600389058741 0.05751667537112635 … 0.08377439233385053 0.091921716557856; … ; 0.08831868155970418 0.08377439258981557 … 0.07075664072488946 0.08377439271909112; 0.1005038938703358 0.09192171678541156 … 0.08377439263056963 0.09659641747138448;;; … ;;; 0.07447652393491845 0.07940930044908463 … 0.031661599462085 0.055030816090166364; 0.0794093003769975 0.07791160958476723 … 0.04792700189700204 0.06826914987698755; … ; 0.03166159951525809 0.04792700206142457 … 0.006870416039996442 0.014215398498769365; 0.05503081615466655 0.06826915002062667 … 0.014215398534480492 0.032048516295696175;;; 0.10056375876455784 0.10050389712509168 … 0.05464060811785059 0.08349600704714638; 0.10050389703745093 0.096596420273427 … 0.07122114559124594 0.09192171986930134; … ; 0.054640608350475954 0.0712211458950824 … 0.006870415784659128 0.02754404332461801; 0.08349600716403775 0.09192172006161756 … 0.02754404321490328 0.05751667751669481;;; 0.12017965702487897 0.11588721311680993 … 0.08349600609413675 0.10912705065398424; 0.1158872130146588 0.10964497813689073 … 0.09192171903398737 0.10964497819065247; … ; 0.08349600636574843 0.09192171934565217 … 0.027544042565177736 0.05751667676265185; 0.1091270507711059 0.10964497838297678 … 0.057516676597447074 0.08971212083331061;;;;], α = 0.8, eigenvalues = [[-0.1443155917462035, 0.29698169231139465, 0.2969816931841233, 0.2969816938632822, 0.3757382673034392, 0.37573826759896656, 0.3757382678189019]], occupation = [[2.0, 2.0, 2.0, 2.0, 0.0, 0.0, 0.0]], εF = 0.344239382253642, n_iter = 15, n_ep_extra = 3, ψ = Matrix{ComplexF64}[[0.6501249786783897 - 0.7111115125567641im 7.675927087698975e-10 - 1.3914383480716151e-9im … 2.6061031359941267e-9 - 4.0853291447652526e-9im 3.015438644002993e-10 - 3.1973740159111803e-9im; 0.058184501781940214 - 0.06364264184083947im 0.28806321184504347 - 0.4095319130669316im … 0.11715421812897543 + 0.07465028767335886im 0.5720820375353388 + 0.05311956931605335im; … ; 0.008646760006093428 - 0.009457890689498363im -0.017942930457537497 + 0.025508987802765837im … 0.05500092160479246 + 0.03504631176870713im 0.07944104196495347 + 0.0073763648981138704im; -0.05818450571783388 + 0.06364263962460928im 0.09284743956417531 - 0.13199880438495362im … 0.37390108554385737 + 0.2382476891069036im 0.1371778023660915 + 0.012737537959423253im]], diagonalization = NamedTuple{(:λ, :X, :residual_norms, :iterations, :converged, :n_matvec), Tuple{Vector{Vector{Float64}}, Vector{Matrix{ComplexF64}}, Vector{Vector{Float64}}, Vector{Int64}, Bool, Int64}}[(λ = [[-0.1443155917462035, 0.29698169231139465, 0.2969816931841233, 0.2969816938632822, 0.3757382673034392, 0.37573826759896656, 0.3757382678189019]], X = [[0.6501249786783897 - 0.7111115125567641im 7.675927087698975e-10 - 1.3914383480716151e-9im … 2.6061031359941267e-9 - 4.0853291447652526e-9im 3.015438644002993e-10 - 3.1973740159111803e-9im; 0.058184501781940214 - 0.06364264184083947im 0.28806321184504347 - 0.4095319130669316im … 0.11715421812897543 + 0.07465028767335886im 0.5720820375353388 + 0.05311956931605335im; … ; 0.008646760006093428 - 0.009457890689498363im -0.017942930457537497 + 0.025508987802765837im … 0.05500092160479246 + 0.03504631176870713im 0.07944104196495347 + 0.0073763648981138704im; -0.05818450571783388 + 0.06364263962460928im 0.09284743956417531 - 0.13199880438495362im … 0.37390108554385737 + 0.2382476891069036im 0.1371778023660915 + 0.012737537959423253im]], residual_norms = [[2.959158893248335e-9, 2.594926146328887e-9, 1.6742026643308595e-9, 4.000330468281833e-9, 2.616633234281913e-9, 1.3456521260136015e-9, 2.3005354842804472e-9]], iterations = [2], converged = 1, n_matvec = 20)], stage = :finalize, algorithm = &quot;SCF&quot;, norm_Δρ = 1.6664432495122275e-8)</code></pre><p>Apply ε† = 1 - χ0 (vc + fxc)</p><pre><code class="language-julia hljs">function eps_fun(δρ)
    δV = apply_kernel(basis, δρ; ρ=scfres.ρ)
    χ0δV = apply_χ0(scfres, δV)
    δρ - χ0δV
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">eps_fun (generic function with 1 method)</code></pre><p>eager diagonalizes the subspace matrix at each iteration</p><pre><code class="language-julia hljs">eigsolve(eps_fun, randn(size(scfres.ρ)), 5, :LM; eager=true, verbosity=3);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Arnoldi iteration step 1: normres = 0.03122245562704035
[ Info: Arnoldi iteration step 2: normres = 0.7029857283767101
[ Info: Arnoldi iteration step 3: normres = 0.7527946218144278
[ Info: Arnoldi iteration step 4: normres = 0.4495536384436201
[ Info: Arnoldi iteration step 5: normres = 0.23496292548755782
[ Info: Arnoldi schursolve in iter 1, krylovdim = 5: 0 values converged, normres = (3.63e-02, 5.01e-02, 1.64e-01, 1.55e-01, 2.21e-02)
[ Info: Arnoldi iteration step 6: normres = 0.5596129508875486
[ Info: Arnoldi schursolve in iter 1, krylovdim = 6: 0 values converged, normres = (1.29e-02, 4.28e-02, 5.30e-01, 1.30e-01, 1.12e-01)
[ Info: Arnoldi iteration step 7: normres = 0.09486390601586152
[ Info: Arnoldi schursolve in iter 1, krylovdim = 7: 0 values converged, normres = (8.27e-04, 1.46e-02, 5.93e-02, 3.86e-02, 5.07e-02)
[ Info: Arnoldi iteration step 8: normres = 0.10195639840851313
[ Info: Arnoldi schursolve in iter 1, krylovdim = 8: 0 values converged, normres = (3.70e-05, 1.09e-03, 4.88e-03, 1.38e-02, 4.46e-02)
[ Info: Arnoldi iteration step 9: normres = 0.09293882280302684
[ Info: Arnoldi schursolve in iter 1, krylovdim = 9: 0 values converged, normres = (1.48e-06, 7.16e-05, 3.55e-04, 4.19e-03, 3.60e-02)
[ Info: Arnoldi iteration step 10: normres = 0.08695374235573784
[ Info: Arnoldi schursolve in iter 1, krylovdim = 10: 0 values converged, normres = (5.67e-08, 4.60e-06, 2.54e-05, 1.49e-03, 4.00e-02)
[ Info: Arnoldi iteration step 11: normres = 0.0792410570482145
[ Info: Arnoldi schursolve in iter 1, krylovdim = 11: 0 values converged, normres = (1.94e-09, 2.58e-07, 1.59e-06, 3.96e-04, 2.29e-02)
[ Info: Arnoldi iteration step 12: normres = 0.0755446747894174
[ Info: Arnoldi schursolve in iter 1, krylovdim = 12: 0 values converged, normres = (6.30e-11, 1.38e-08, 9.39e-08, 9.60e-05, 1.13e-02)
[ Info: Arnoldi iteration step 13: normres = 0.057243753635495075
[ Info: Arnoldi schursolve in iter 1, krylovdim = 13: 0 values converged, normres = (1.52e-12, 5.40e-10, 4.06e-09, 1.52e-05, 3.27e-03)
[ Info: Arnoldi iteration step 14: normres = 0.6085602024155133
[ Info: Arnoldi schursolve in iter 1, krylovdim = 14: 1 values converged, normres = (7.36e-13, 9.37e-10, 1.17e-08, 6.07e-01, 4.66e-03)
[ Info: Arnoldi iteration step 15: normres = 0.11524006918714333
[ Info: Arnoldi schursolve in iter 1, krylovdim = 15: 1 values converged, normres = (4.72e-14, 1.12e-09, 5.30e-02, 2.74e-05, 2.64e-06)
[ Info: Arnoldi iteration step 16: normres = 0.3406506328328261
[ Info: Arnoldi schursolve in iter 1, krylovdim = 16: 1 values converged, normres = (1.44e-14, 4.31e-09, 8.53e-02, 4.54e-04, 3.27e-01)
[ Info: Arnoldi iteration step 17: normres = 0.030369515021043077
[ Info: Arnoldi schursolve in iter 1, krylovdim = 17: 1 values converged, normres = (1.98e-16, 3.03e-08, 2.83e-03, 6.46e-03, 3.04e-03)
[ Info: Arnoldi iteration step 18: normres = 0.01606270263347338
[ Info: Arnoldi schursolve in iter 1, krylovdim = 18: 1 values converged, normres = (1.31e-18, 2.36e-05, 1.85e-05, 5.74e-08, 8.34e-05)
[ Info: Arnoldi iteration step 19: normres = 0.19873667359735878
[ Info: Arnoldi schursolve in iter 1, krylovdim = 19: 1 values converged, normres = (1.13e-19, 2.33e-08, 4.26e-06, 1.31e-05, 7.51e-07)
[ Info: Arnoldi iteration step 20: normres = 0.03889762537102527
[ Info: Arnoldi schursolve in iter 1, krylovdim = 20: 1 values converged, normres = (2.08e-21, 3.73e-08, 1.34e-07, 4.28e-08, 4.85e-07)
[ Info: Arnoldi iteration step 21: normres = 0.03416871873046771
[ Info: Arnoldi schursolve in iter 1, krylovdim = 21: 1 values converged, normres = (2.96e-23, 2.77e-09, 1.54e-09, 6.77e-09, 1.02e-08)
[ Info: Arnoldi iteration step 22: normres = 0.04893184560550478
[ Info: Arnoldi schursolve in iter 1, krylovdim = 22: 1 values converged, normres = (6.01e-25, 8.77e-11, 5.41e-11, 2.36e-10, 3.71e-10)
[ Info: Arnoldi iteration step 23: normres = 0.4294056701987425
[ Info: Arnoldi schursolve in iter 1, krylovdim = 23: 1 values converged, normres = (2.18e-25, 1.37e-10, 8.33e-11, 7.36e-10, 1.17e-09)
[ Info: Arnoldi iteration step 24: normres = 0.02644822299581727
[ Info: Arnoldi schursolve in iter 1, krylovdim = 24: 1 values converged, normres = (2.66e-27, 4.64e-12, 2.85e-12, 4.27e-03, 9.40e-04)
[ Info: Arnoldi iteration step 25: normres = 0.11830664572886747
[ Info: Arnoldi schursolve in iter 1, krylovdim = 25: 3 values converged, normres = (1.38e-28, 3.97e-13, 2.44e-13, 8.34e-09, 1.08e-08)
[ Info: Arnoldi iteration step 26: normres = 0.015336884954199687
[ Info: Arnoldi schursolve in iter 1, krylovdim = 26: 3 values converged, normres = (9.05e-31, 4.28e-15, 2.63e-15, 8.35e-06, 4.48e-07)
[ Info: Arnoldi iteration step 27: normres = 0.05961826689359269
[ Info: Arnoldi schursolve in iter 1, krylovdim = 27: 3 values converged, normres = (2.23e-32, 1.69e-16, 1.04e-16, 1.56e-07, 1.27e-07)
[ Info: Arnoldi iteration step 28: normres = 0.05801600823422109
[ Info: Arnoldi schursolve in iter 1, krylovdim = 28: 3 values converged, normres = (5.71e-34, 7.20e-18, 4.43e-18, 1.76e-09, 1.73e-08)
[ Info: Arnoldi iteration step 29: normres = 0.15108476280323294
[ Info: Arnoldi schursolve in iter 1, krylovdim = 29: 3 values converged, normres = (3.64e-35, 7.43e-19, 4.57e-19, 2.55e-10, 2.09e-09)
[ Info: Arnoldi iteration step 30: normres = 0.038196806964889675
[ Info: Arnoldi schursolve in iter 1, krylovdim = 30: 3 values converged, normres = (6.78e-37, 2.49e-20, 1.53e-20, 9.62e-12, 7.97e-11)
[ Info: Arnoldi schursolve in iter 2, krylovdim = 19: 3 values converged, normres = (6.84e-37, 2.49e-20, 1.53e-20, 9.62e-12, 7.97e-11)
[ Info: Arnoldi iteration step 20: normres = 0.03166882091206183
[ Info: Arnoldi schursolve in iter 2, krylovdim = 20: 4 values converged, normres = (8.79e-39, 5.14e-22, 3.16e-22, 2.19e-13, 1.81e-12)
[ Info: Arnoldi iteration step 21: normres = 0.07444932487327692
┌ Info: Arnoldi eigsolve finished after 2 iterations:
│ *  6 eigenvalues converged
│ *  norm of residuals = (2.733588955559338e-40, 2.5715450767488566e-23, 1.809621069136419e-23, 1.2067331286841967e-14, 1.0072279467951981e-13, 2.7943920303099144e-14)
└ *  number of operations = 32</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forwarddiff/">« Polarizability using automatic differentiation</a><a class="docs-footer-nextpage" href="../atomsbase/">AtomsBase integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 22 September 2022 14:05">Thursday 22 September 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
