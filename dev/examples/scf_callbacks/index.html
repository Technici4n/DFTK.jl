<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Monitoring self-consistent field calculations · DFTK.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.dftk.org/stable/examples/scf_callbacks/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/periodic_problems/">Problems and plane-wave discretisations</a></li><li><a class="tocitem" href="../../guide/introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../pseudopotentials/">Pseudopotentials</a></li><li><a class="tocitem" href="../supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../forwarddiff/">Polarizability using automatic differentiation</a></li><li><a class="tocitem" href="../dielectric/">Eigenvalues of the dielectric matrix</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../input_output/">Input and output formats</a></li><li><a class="tocitem" href="../wannier90/">Wannierization using Wannier90</a></li></ul></li><li><span class="tocitem">Tipps and tricks</span><ul><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../custom_solvers/">Custom solvers</a></li><li class="is-active"><a class="tocitem" href>Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../compare_solvers/">Comparison of DFT solvers</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../../developer/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../developer/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../developer/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../developer/symmetries/">Crystal symmetries</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Solvers</a></li><li class="is-active"><a href>Monitoring self-consistent field calculations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Monitoring self-consistent field calculations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/examples/scf_callbacks.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Monitoring-self-consistent-field-calculations"><a class="docs-heading-anchor" href="#Monitoring-self-consistent-field-calculations">Monitoring self-consistent field calculations</a><a id="Monitoring-self-consistent-field-calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Monitoring-self-consistent-field-calculations" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=dev/examples/scf_callbacks.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/dev/examples/scf_callbacks.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>The <code>self_consistent_field</code> function takes as the <code>callback</code> keyword argument one function to be called after each iteration. This function gets passed the complete internal state of the SCF solver and can thus be used both to monitor and debug the iterations as well as to quickly patch it with additional functionality.</p><p>This example discusses a few aspects of the <code>callback</code> function taking again our favourite silicon example.</p><p>We setup silicon in an LDA model using the ASE interface to build the silicon lattice, see <a href="../input_output/#Input-and-output-formats">Input and output formats</a> for more details.</p><pre><code class="language-julia hljs">using DFTK
using PyCall

silicon = pyimport(&quot;ase.build&quot;).bulk(&quot;Si&quot;)
atoms = [ElementPsp(el.symbol, psp=load_psp(&quot;hgh/lda/si-q4.hgh&quot;))
         for el in load_atoms(silicon)]
positions = load_positions(silicon)
lattice   = load_lattice(silicon);

model = model_LDA(lattice, atoms, positions)
basis = PlaneWaveBasis(model; Ecut=5, kgrid=[3, 3, 3]);</code></pre><p>DFTK already defines a few callback functions for standard tasks. One example is the usual convergence table, which is defined in the callback <code>ScfDefaultCallback</code>. Another example is <code>ScfPlotTrace</code>, which records the total energy at each iteration and uses it to plot the convergence of the SCF graphically once it is converged. For details and other callbacks see <a href="https://dftk.org/blob/master/src/scf/scf_callbacks.jl"><code>src/scf/scf_callbacks.jl</code></a>.</p><div class="admonition is-info"><header class="admonition-header">Callbacks are not exported</header><div class="admonition-body"><p>Callbacks are not exported from the DFTK namespace as of now, so you will need to use them, e.g., as <code>DFTK.ScfDefaultCallback</code> and <code>DFTK.ScfPlotTrace</code>.</p></div></div><p>In this example we define a custom callback, which plots the change in density at each SCF iteration after the SCF has finished. For this we first define the empty plot canvas and an empty container for all the density differences:</p><pre><code class="language-julia hljs">using Plots
p = plot(yaxis=:log)
density_differences = Float64[];</code></pre><p>The callback function itself gets passed a named tuple similar to the one returned by <code>self_consistent_field</code>, which contains the input and output density of the SCF step as <code>ρin</code> and <code>ρout</code>. Since the callback gets called both during the SCF iterations as well as after convergence just before <code>self_consistent_field</code> finishes we can both collect the data and initiate the plotting in one function.</p><pre><code class="language-julia hljs">using LinearAlgebra

function plot_callback(info)
    if info.stage == :finalize
        plot!(p, density_differences, label=&quot;|ρout - ρin|&quot;, markershape=:x)
    else
        push!(density_differences, norm(info.ρout - info.ρin))
    end
    info
end
callback = DFTK.ScfDefaultCallback() ∘ plot_callback;</code></pre><p>Notice that for constructing the <code>callback</code> function we chained the <code>plot_callback</code> (which does the plotting) with the <code>ScfDefaultCallback</code>, such that when using the <code>plot_callback</code> function with <code>self_consistent_field</code> we still get the usual convergence table printed. We run the SCF with this callback …</p><pre><code class="language-julia hljs">scfres = self_consistent_field(basis; tol=1e-8, callback);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">n     Energy            log10(ΔE)   log10(Δρ)   α      Diag
---   ---------------   ---------   ---------   ----   ----
  1   -7.846705665068                   -0.70   0.80    4.6
  2   -7.852285000338       -2.25       -1.54   0.80    1.0
  3   -7.852621383939       -3.47       -2.53   0.80    3.0
  4   -7.852621951570       -6.25       -3.38   0.80    2.2
  5   -7.852621959649       -8.09       -4.69   0.80    1.6</code></pre><p>… and show the plot</p><pre><code class="language-julia hljs">p</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip780">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip780)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip781">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip780)" d="
M189.496 1486.45 L2352.76 1486.45 L2352.76 47.2441 L189.496 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip782">
    <rect x="189" y="47" width="2164" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  250.72,1486.45 250.72,47.2441 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  760.923,1486.45 760.923,47.2441 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1271.13,1486.45 1271.13,47.2441 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1781.33,1486.45 1781.33,47.2441 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2291.53,1486.45 2291.53,47.2441 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,1486.45 2352.76,1486.45 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  250.72,1486.45 250.72,1467.55 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  760.923,1486.45 760.923,1467.55 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1271.13,1486.45 1271.13,1467.55 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1781.33,1486.45 1781.33,1467.55 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2291.53,1486.45 2291.53,1467.55 
  "/>
<path clip-path="url(#clip780)" d="M241.102 1544.91 L248.741 1544.91 L248.741 1518.55 L240.431 1520.21 L240.431 1515.95 L248.695 1514.29 L253.371 1514.29 L253.371 1544.91 L261.01 1544.91 L261.01 1548.85 L241.102 1548.85 L241.102 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M755.576 1544.91 L771.895 1544.91 L771.895 1548.85 L749.951 1548.85 L749.951 1544.91 Q752.613 1542.16 757.196 1537.53 Q761.803 1532.88 762.983 1531.53 Q765.229 1529.01 766.108 1527.27 Q767.011 1525.51 767.011 1523.82 Q767.011 1521.07 765.067 1519.33 Q763.145 1517.6 760.043 1517.6 Q757.844 1517.6 755.391 1518.36 Q752.96 1519.13 750.182 1520.68 L750.182 1515.95 Q753.006 1514.82 755.46 1514.24 Q757.914 1513.66 759.951 1513.66 Q765.321 1513.66 768.516 1516.35 Q771.71 1519.03 771.71 1523.52 Q771.71 1525.65 770.9 1527.57 Q770.113 1529.47 768.006 1532.07 Q767.428 1532.74 764.326 1535.95 Q761.224 1539.15 755.576 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M1275.37 1530.21 Q1278.73 1530.93 1280.61 1533.2 Q1282.5 1535.47 1282.5 1538.8 Q1282.5 1543.92 1278.98 1546.72 Q1275.47 1549.52 1268.98 1549.52 Q1266.81 1549.52 1264.49 1549.08 Q1262.2 1548.66 1259.75 1547.81 L1259.75 1543.29 Q1261.69 1544.43 1264.01 1545.01 Q1266.32 1545.58 1268.85 1545.58 Q1273.24 1545.58 1275.54 1543.85 Q1277.85 1542.11 1277.85 1538.8 Q1277.85 1535.75 1275.7 1534.03 Q1273.57 1532.3 1269.75 1532.3 L1265.72 1532.3 L1265.72 1528.45 L1269.93 1528.45 Q1273.38 1528.45 1275.21 1527.09 Q1277.04 1525.7 1277.04 1523.11 Q1277.04 1520.45 1275.14 1519.03 Q1273.27 1517.6 1269.75 1517.6 Q1267.83 1517.6 1265.63 1518.01 Q1263.43 1518.43 1260.79 1519.31 L1260.79 1515.14 Q1263.45 1514.4 1265.77 1514.03 Q1268.11 1513.66 1270.17 1513.66 Q1275.49 1513.66 1278.59 1516.09 Q1281.69 1518.5 1281.69 1522.62 Q1281.69 1525.49 1280.05 1527.48 Q1278.41 1529.45 1275.37 1530.21 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M1784.34 1518.36 L1772.53 1536.81 L1784.34 1536.81 L1784.34 1518.36 M1783.11 1514.29 L1788.99 1514.29 L1788.99 1536.81 L1793.92 1536.81 L1793.92 1540.7 L1788.99 1540.7 L1788.99 1548.85 L1784.34 1548.85 L1784.34 1540.7 L1768.74 1540.7 L1768.74 1536.19 L1783.11 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2281.81 1514.29 L2300.17 1514.29 L2300.17 1518.22 L2286.09 1518.22 L2286.09 1526.7 Q2287.11 1526.35 2288.13 1526.19 Q2289.15 1526 2290.17 1526 Q2295.95 1526 2299.33 1529.17 Q2302.71 1532.34 2302.71 1537.76 Q2302.71 1543.34 2299.24 1546.44 Q2295.77 1549.52 2289.45 1549.52 Q2287.27 1549.52 2285 1549.15 Q2282.76 1548.78 2280.35 1548.04 L2280.35 1543.34 Q2282.43 1544.47 2284.66 1545.03 Q2286.88 1545.58 2289.36 1545.58 Q2293.36 1545.58 2295.7 1543.48 Q2298.04 1541.37 2298.04 1537.76 Q2298.04 1534.15 2295.7 1532.04 Q2293.36 1529.94 2289.36 1529.94 Q2287.48 1529.94 2285.61 1530.35 Q2283.75 1530.77 2281.81 1531.65 L2281.81 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  189.496,1436.76 2352.76,1436.76 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  189.496,1096.42 2352.76,1096.42 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  189.496,756.073 2352.76,756.073 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  189.496,415.728 2352.76,415.728 
  "/>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  189.496,75.3832 2352.76,75.3832 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,1486.45 189.496,47.2441 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,1436.76 208.394,1436.76 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,1096.42 208.394,1096.42 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,756.073 208.394,756.073 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,415.728 208.394,415.728 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  189.496,75.3832 208.394,75.3832 
  "/>
<path clip-path="url(#clip780)" d="M51.6634 1456.56 L59.3023 1456.56 L59.3023 1430.19 L50.9921 1431.86 L50.9921 1427.6 L59.256 1425.93 L63.9319 1425.93 L63.9319 1456.56 L71.5707 1456.56 L71.5707 1460.49 L51.6634 1460.49 L51.6634 1456.56 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M91.0151 1429.01 Q87.404 1429.01 85.5753 1432.57 Q83.7697 1436.12 83.7697 1443.25 Q83.7697 1450.35 85.5753 1453.92 Q87.404 1457.46 91.0151 1457.46 Q94.6493 1457.46 96.4548 1453.92 Q98.2835 1450.35 98.2835 1443.25 Q98.2835 1436.12 96.4548 1432.57 Q94.6493 1429.01 91.0151 1429.01 M91.0151 1425.31 Q96.8252 1425.31 99.8808 1429.91 Q102.959 1434.5 102.959 1443.25 Q102.959 1451.97 99.8808 1456.58 Q96.8252 1461.16 91.0151 1461.16 Q85.2049 1461.16 82.1262 1456.58 Q79.0707 1451.97 79.0707 1443.25 Q79.0707 1434.5 82.1262 1429.91 Q85.2049 1425.31 91.0151 1425.31 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M102.959 1419.41 L127.071 1419.41 L127.071 1422.6 L102.959 1422.6 L102.959 1419.41 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M145.71 1408.31 L136.118 1423.3 L145.71 1423.3 L145.71 1408.31 M144.713 1405 L149.49 1405 L149.49 1423.3 L153.496 1423.3 L153.496 1426.46 L149.49 1426.46 L149.49 1433.08 L145.71 1433.08 L145.71 1426.46 L133.033 1426.46 L133.033 1422.79 L144.713 1405 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M52.585 1116.21 L60.2238 1116.21 L60.2238 1089.85 L51.9137 1091.51 L51.9137 1087.25 L60.1776 1085.59 L64.8535 1085.59 L64.8535 1116.21 L72.4923 1116.21 L72.4923 1120.15 L52.585 1120.15 L52.585 1116.21 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M91.9366 1088.66 Q88.3255 1088.66 86.4969 1092.23 Q84.6913 1095.77 84.6913 1102.9 Q84.6913 1110.01 86.4969 1113.57 Q88.3255 1117.11 91.9366 1117.11 Q95.5709 1117.11 97.3764 1113.57 Q99.2051 1110.01 99.2051 1102.9 Q99.2051 1095.77 97.3764 1092.23 Q95.5709 1088.66 91.9366 1088.66 M91.9366 1084.96 Q97.7468 1084.96 100.802 1089.57 Q103.881 1094.15 103.881 1102.9 Q103.881 1111.63 100.802 1116.23 Q97.7468 1120.82 91.9366 1120.82 Q86.1265 1120.82 83.0478 1116.23 Q79.9923 1111.63 79.9923 1102.9 Q79.9923 1094.15 83.0478 1089.57 Q86.1265 1084.96 91.9366 1084.96 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M103.881 1079.06 L127.993 1079.06 L127.993 1082.26 L103.881 1082.26 L103.881 1079.06 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M147.703 1077.6 Q150.43 1078.18 151.954 1080.02 Q153.496 1081.86 153.496 1084.57 Q153.496 1088.73 150.637 1091.01 Q147.778 1093.28 142.512 1093.28 Q140.744 1093.28 138.863 1092.92 Q137.002 1092.59 135.008 1091.89 L135.008 1088.22 Q136.588 1089.14 138.469 1089.61 Q140.349 1090.08 142.399 1090.08 Q145.973 1090.08 147.835 1088.67 Q149.716 1087.26 149.716 1084.57 Q149.716 1082.09 147.966 1080.7 Q146.236 1079.29 143.133 1079.29 L139.86 1079.29 L139.86 1076.17 L143.283 1076.17 Q146.086 1076.17 147.571 1075.06 Q149.057 1073.93 149.057 1071.82 Q149.057 1069.66 147.515 1068.51 Q145.992 1067.35 143.133 1067.35 Q141.572 1067.35 139.785 1067.68 Q137.998 1068.02 135.854 1068.74 L135.854 1065.35 Q138.017 1064.75 139.898 1064.45 Q141.797 1064.15 143.471 1064.15 Q147.797 1064.15 150.317 1066.12 Q152.838 1068.08 152.838 1071.43 Q152.838 1073.76 151.502 1075.38 Q150.167 1076.97 147.703 1077.6 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M53.3561 775.866 L60.995 775.866 L60.995 749.5 L52.6848 751.167 L52.6848 746.908 L60.9487 745.241 L65.6246 745.241 L65.6246 775.866 L73.2634 775.866 L73.2634 779.801 L53.3561 779.801 L53.3561 775.866 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M92.7078 748.32 Q89.0967 748.32 87.268 751.884 Q85.4624 755.426 85.4624 762.556 Q85.4624 769.662 87.268 773.227 Q89.0967 776.769 92.7078 776.769 Q96.342 776.769 98.1475 773.227 Q99.9762 769.662 99.9762 762.556 Q99.9762 755.426 98.1475 751.884 Q96.342 748.32 92.7078 748.32 M92.7078 744.616 Q98.5179 744.616 101.573 749.222 Q104.652 753.806 104.652 762.556 Q104.652 771.282 101.573 775.889 Q98.5179 780.472 92.7078 780.472 Q86.8976 780.472 83.8189 775.889 Q80.7634 771.282 80.7634 762.556 Q80.7634 753.806 83.8189 749.222 Q86.8976 744.616 92.7078 744.616 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M104.652 738.717 L128.764 738.717 L128.764 741.915 L104.652 741.915 L104.652 738.717 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M140.236 749.193 L153.496 749.193 L153.496 752.391 L135.666 752.391 L135.666 749.193 Q137.829 746.955 141.553 743.194 Q145.296 739.413 146.255 738.322 Q148.079 736.272 148.794 734.862 Q149.527 733.432 149.527 732.059 Q149.527 729.821 147.948 728.411 Q146.387 727 143.866 727 Q142.08 727 140.086 727.621 Q138.111 728.241 135.854 729.501 L135.854 725.665 Q138.149 724.743 140.142 724.273 Q142.136 723.803 143.791 723.803 Q148.155 723.803 150.75 725.984 Q153.345 728.166 153.345 731.815 Q153.345 733.545 152.687 735.106 Q152.048 736.648 150.336 738.755 Q149.866 739.3 147.346 741.915 Q144.826 744.51 140.236 749.193 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M53.0552 435.521 L60.694 435.521 L60.694 409.155 L52.3839 410.822 L52.3839 406.563 L60.6477 404.896 L65.3236 404.896 L65.3236 435.521 L72.9625 435.521 L72.9625 439.456 L53.0552 439.456 L53.0552 435.521 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M92.4068 407.975 Q88.7957 407.975 86.967 411.539 Q85.1615 415.081 85.1615 422.211 Q85.1615 429.317 86.967 432.882 Q88.7957 436.423 92.4068 436.423 Q96.0411 436.423 97.8466 432.882 Q99.6753 429.317 99.6753 422.211 Q99.6753 415.081 97.8466 411.539 Q96.0411 407.975 92.4068 407.975 M92.4068 404.271 Q98.217 404.271 101.273 408.877 Q104.351 413.461 104.351 422.211 Q104.351 430.937 101.273 435.544 Q98.217 440.127 92.4068 440.127 Q86.5967 440.127 83.518 435.544 Q80.4625 430.937 80.4625 422.211 Q80.4625 413.461 83.518 408.877 Q86.5967 404.271 92.4068 404.271 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M104.351 398.372 L128.463 398.372 L128.463 401.57 L104.351 401.57 L104.351 398.372 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M137.321 408.848 L143.528 408.848 L143.528 387.426 L136.776 388.78 L136.776 385.32 L143.49 383.965 L147.289 383.965 L147.289 408.848 L153.496 408.848 L153.496 412.045 L137.321 412.045 L137.321 408.848 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M82.7903 95.1757 L90.4291 95.1757 L90.4291 68.8101 L82.119 70.4767 L82.119 66.2175 L90.3828 64.5508 L95.0587 64.5508 L95.0587 95.1757 L102.698 95.1757 L102.698 99.1108 L82.7903 99.1108 L82.7903 95.1757 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M122.142 67.6295 Q118.531 67.6295 116.702 71.1943 Q114.897 74.736 114.897 81.8655 Q114.897 88.972 116.702 92.5368 Q118.531 96.0784 122.142 96.0784 Q125.776 96.0784 127.582 92.5368 Q129.41 88.972 129.41 81.8655 Q129.41 74.736 127.582 71.1943 Q125.776 67.6295 122.142 67.6295 M122.142 63.9258 Q127.952 63.9258 131.008 68.5323 Q134.086 73.1156 134.086 81.8655 Q134.086 90.5924 131.008 95.1988 Q127.952 99.7821 122.142 99.7821 Q116.332 99.7821 113.253 95.1988 Q110.198 90.5924 110.198 81.8655 Q110.198 73.1156 113.253 68.5323 Q116.332 63.9258 122.142 63.9258 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M143.791 46.1219 Q140.857 46.1219 139.371 49.0183 Q137.904 51.8958 137.904 57.6886 Q137.904 63.4626 139.371 66.359 Q140.857 69.2366 143.791 69.2366 Q146.744 69.2366 148.211 66.359 Q149.697 63.4626 149.697 57.6886 Q149.697 51.8958 148.211 49.0183 Q146.744 46.1219 143.791 46.1219 M143.791 43.1126 Q148.512 43.1126 150.994 46.8554 Q153.496 50.5793 153.496 57.6886 Q153.496 64.7792 150.994 68.5219 Q148.512 72.2459 143.791 72.2459 Q139.07 72.2459 136.569 68.5219 Q134.086 64.7792 134.086 57.6886 Q134.086 50.5793 136.569 46.8554 Q139.07 43.1126 143.791 43.1126 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip782)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  250.72,87.9763 760.923,372.279 1271.13,710.526 1781.33,998.231 2291.53,1445.72 
  "/>
<line clip-path="url(#clip782)" x1="250.72" y1="87.9763" x2="234.72" y2="71.9763" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="250.72" y1="87.9763" x2="234.72" y2="103.976" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="250.72" y1="87.9763" x2="266.72" y2="103.976" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="250.72" y1="87.9763" x2="266.72" y2="71.9763" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="760.923" y1="372.279" x2="744.923" y2="356.279" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="760.923" y1="372.279" x2="744.923" y2="388.279" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="760.923" y1="372.279" x2="776.923" y2="388.279" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="760.923" y1="372.279" x2="776.923" y2="356.279" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1271.13" y1="710.526" x2="1255.13" y2="694.526" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1271.13" y1="710.526" x2="1255.13" y2="726.526" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1271.13" y1="710.526" x2="1287.13" y2="726.526" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1271.13" y1="710.526" x2="1287.13" y2="694.526" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1781.33" y1="998.231" x2="1765.33" y2="982.231" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1781.33" y1="998.231" x2="1765.33" y2="1014.23" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1781.33" y1="998.231" x2="1797.33" y2="1014.23" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="1781.33" y1="998.231" x2="1797.33" y2="982.231" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="2291.53" y1="1445.72" x2="2275.53" y2="1429.72" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="2291.53" y1="1445.72" x2="2275.53" y2="1461.72" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="2291.53" y1="1445.72" x2="2307.53" y2="1461.72" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<line clip-path="url(#clip782)" x1="2291.53" y1="1445.72" x2="2307.53" y2="1429.72" style="stroke:#009af9; stroke-width:3.2; stroke-opacity:1"/>
<path clip-path="url(#clip780)" d="
M1816.13 198.898 L2280.65 198.898 L2280.65 95.2176 L1816.13 95.2176  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1816.13,198.898 2280.65,198.898 2280.65,95.2176 1816.13,95.2176 1816.13,198.898 
  "/>
<polyline clip-path="url(#clip780)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1840.16,147.058 1984.38,147.058 
  "/>
<line clip-path="url(#clip780)" x1="1912.27" y1="147.058" x2="1890.02" y2="124.802" style="stroke:#009af9; stroke-width:5.12; stroke-opacity:1"/>
<line clip-path="url(#clip780)" x1="1912.27" y1="147.058" x2="1890.02" y2="169.313" style="stroke:#009af9; stroke-width:5.12; stroke-opacity:1"/>
<line clip-path="url(#clip780)" x1="1912.27" y1="147.058" x2="1934.53" y2="169.313" style="stroke:#009af9; stroke-width:5.12; stroke-opacity:1"/>
<line clip-path="url(#clip780)" x1="1912.27" y1="147.058" x2="1934.53" y2="124.802" style="stroke:#009af9; stroke-width:5.12; stroke-opacity:1"/>
<path clip-path="url(#clip780)" d="M2012.35 128.111 L2012.35 175.518 L2008.42 175.518 L2008.42 128.111 L2012.35 128.111 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2024.76 143.041 Q2026.17 140.68 2029.67 138.597 Q2031.03 137.787 2035.25 137.787 Q2039.97 137.787 2042.91 141.537 Q2045.87 145.287 2045.87 151.398 Q2045.87 157.509 2042.91 161.259 Q2039.97 165.009 2035.25 165.009 Q2032.4 165.009 2030.34 163.898 Q2028.3 162.763 2026.96 160.449 L2026.96 174.199 L2022.68 174.199 L2022.68 151.629 Q2022.68 146.282 2024.76 143.041 M2041.45 151.398 Q2041.45 146.699 2039.51 144.037 Q2037.58 141.352 2034.2 141.352 Q2030.83 141.352 2028.88 144.037 Q2026.96 146.699 2026.96 151.398 Q2026.96 156.097 2028.88 158.782 Q2030.83 161.444 2034.2 161.444 Q2037.58 161.444 2039.51 158.782 Q2041.45 156.097 2041.45 151.398 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2062.98 141.398 Q2059.55 141.398 2057.56 144.083 Q2055.57 146.745 2055.57 151.398 Q2055.57 156.051 2057.54 158.736 Q2059.53 161.398 2062.98 161.398 Q2066.38 161.398 2068.37 158.713 Q2070.36 156.027 2070.36 151.398 Q2070.36 146.791 2068.37 144.106 Q2066.38 141.398 2062.98 141.398 M2062.98 137.787 Q2068.53 137.787 2071.7 141.398 Q2074.88 145.009 2074.88 151.398 Q2074.88 157.764 2071.7 161.398 Q2068.53 165.009 2062.98 165.009 Q2057.4 165.009 2054.23 161.398 Q2051.08 157.764 2051.08 151.398 Q2051.08 145.009 2054.23 141.398 Q2057.4 137.787 2062.98 137.787 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2081.5 154.106 L2081.5 138.412 L2085.76 138.412 L2085.76 153.944 Q2085.76 157.625 2087.19 159.476 Q2088.63 161.305 2091.5 161.305 Q2094.95 161.305 2096.94 159.106 Q2098.95 156.907 2098.95 153.111 L2098.95 138.412 L2103.21 138.412 L2103.21 164.338 L2098.95 164.338 L2098.95 160.356 Q2097.4 162.717 2095.34 163.875 Q2093.3 165.009 2090.59 165.009 Q2086.13 165.009 2083.81 162.231 Q2081.5 159.453 2081.5 154.106 M2092.21 137.787 L2092.21 137.787 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2116.2 131.051 L2116.2 138.412 L2124.97 138.412 L2124.97 141.722 L2116.2 141.722 L2116.2 155.796 Q2116.2 158.967 2117.05 159.87 Q2117.93 160.773 2120.59 160.773 L2124.97 160.773 L2124.97 164.338 L2120.59 164.338 Q2115.66 164.338 2113.79 162.509 Q2111.91 160.657 2111.91 155.796 L2111.91 141.722 L2108.79 141.722 L2108.79 138.412 L2111.91 138.412 L2111.91 131.051 L2116.2 131.051 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2143.49 149.453 L2155.96 149.453 L2155.96 153.25 L2143.49 153.25 L2143.49 149.453 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2179.74 143.041 Q2181.15 140.68 2184.64 138.597 Q2186.01 137.787 2190.22 137.787 Q2194.94 137.787 2197.88 141.537 Q2200.85 145.287 2200.85 151.398 Q2200.85 157.509 2197.88 161.259 Q2194.94 165.009 2190.22 165.009 Q2187.38 165.009 2185.32 163.898 Q2183.28 162.763 2181.94 160.449 L2181.94 174.199 L2177.65 174.199 L2177.65 151.629 Q2177.65 146.282 2179.74 143.041 M2196.43 151.398 Q2196.43 146.699 2194.48 144.037 Q2192.56 141.352 2189.18 141.352 Q2185.8 141.352 2183.86 144.037 Q2181.94 146.699 2181.94 151.398 Q2181.94 156.097 2183.86 158.782 Q2185.8 161.444 2189.18 161.444 Q2192.56 161.444 2194.48 158.782 Q2196.43 156.097 2196.43 151.398 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2207.91 138.412 L2212.17 138.412 L2212.17 164.338 L2207.91 164.338 L2207.91 138.412 M2207.91 128.319 L2212.17 128.319 L2212.17 133.713 L2207.91 133.713 L2207.91 128.319 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2242.63 148.689 L2242.63 164.338 L2238.37 164.338 L2238.37 148.828 Q2238.37 145.148 2236.94 143.319 Q2235.5 141.49 2232.63 141.49 Q2229.18 141.49 2227.19 143.69 Q2225.2 145.889 2225.2 149.685 L2225.2 164.338 L2220.92 164.338 L2220.92 138.412 L2225.2 138.412 L2225.2 142.44 Q2226.73 140.102 2228.79 138.944 Q2230.87 137.787 2233.58 137.787 Q2238.05 137.787 2240.34 140.565 Q2242.63 143.319 2242.63 148.689 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip780)" d="M2256.61 128.111 L2256.61 175.518 L2252.68 175.518 L2252.68 128.111 L2256.61 128.111 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>The <code>info</code> object passed to the callback contains not just the densities but also the complete Bloch wave (in <code>ψ</code>), the <code>occupation</code>, band <code>eigenvalues</code> and so on. See <a href="https://dftk.org/blob/master/src/scf/self_consistent_field.jl#L101"><code>src/scf/self_consistent_field.jl</code></a> for all currently available keys.</p><div class="admonition is-success"><header class="admonition-header">Debugging with callbacks</header><div class="admonition-body"><p>Very handy for debugging SCF algorithms is to employ callbacks with an <code>@infiltrate</code> from <a href="https://github.com/JuliaDebug/Infiltrator.jl">Infiltrator.jl</a> to interactively monitor what is happening each SCF step.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../custom_solvers/">« Custom solvers</a><a class="docs-footer-nextpage" href="../compare_solvers/">Comparison of DFT solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 5 December 2022 12:04">Monday 5 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
